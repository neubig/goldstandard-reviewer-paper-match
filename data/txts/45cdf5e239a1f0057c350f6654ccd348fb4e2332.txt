arXiv:1607.02917v1 [cs.GT] 11 Jul 2016

Stable Matching with Uncertain Linear Preferences ∗
Haris Aziz12, P´eter Biro´3, Serge Gaspers21, Ronald de Haan4, Nicholas Mattei12, and Baharak Rastegari5
1 Data61 (formerly: NICTA), CSIRO, Sydney, Australia. haris.aziz@data61.csiro.au, nicholas.mattei@data61.csiro.au 2 University of New South Wales, Sydney, Australia. sergeg@cse.unsw.edu.au 3 Hungarian Academy of Sciences, Institute of Economics. peter.biro@krtk.mta.hu
4 TU Wien, Vienna, Austria. dehaan@ac.tuwien.ac.at 5 School of Computing Science, University of Glasgow, Glasgow, UK.
baharak.rastegari@glasgow.ac.uk
Abstract. We consider the two-sided stable matching setting in which there may be uncertainty about the agents’ preferences due to limited information or communication. We consider three models of uncertainty: (1) lottery model — in which for each agent, there is a probability distribution over linear preferences, (2) compact indiﬀerence model — for each agent, a weak preference order is speciﬁed and each linear order compatible with the weak order is equally likely and (3) joint probability model — there is a lottery over preference proﬁles. For each of the models, we study the computational complexity of computing the stability probability of a given matching as well as ﬁnding a matching with the highest probability of being stable. We also examine more restricted problems such as deciding whether a certainly stable matching exists. We ﬁnd a rich complexity landscape for these problems, indicating that the form uncertainty takes is signiﬁcant.
1 Introduction
We consider a Stable Marriage problem (SM) in which there is a set of men and a set of women. Each man has a linear order over the women, and each woman has a linear order over the men. For the purpose of this paper we assume that the preference lists are complete, i.e., each agent ﬁnds each member of the opposite side acceptable.6 In the stable marriage problem the goal is to compute a stable matching; a matching where no two agents prefer to be matched to each other rather than be matched to their current partners. Unlike most of
∗ A preliminary version of this paper has been accepted for publication in the proceedings of the 9th International Symposium on Algorithmic Game Theory (SAGT 2016).
6 We note that the complexity of all problems that we study are the same for complete and incomplete lists, where non-listed agents are deemed unacceptable—see Proposition 2 in Section 3.1.

the literature on stable matching problems [6, 11, 14], we assume that men and women may have uncertainty in their preferences which can be captured by various probabilistic uncertainty models. We focus on linear models in which each possible deterministic preference proﬁle is a set of linear orders.
Uncertainty in preferences could arise for a number of reasons both practical or epistemological. For example, an agent could express a weak order because the agent did not invest enough time or eﬀort to diﬀerentiate between potential matches and therefore one could assume that each linear extension of the weak order is equally likely; this maps to our compact indiﬀerence model. In many real applications the ties are broken randomly with lotteries, e.g., in the school choice programs in New York and Boston as well as in centralized college admissions in Ireland. However, a central planner may also choose a matching that is optimal in some sense, without breaking the ties in the preference list. For instance, in Scotland they used to compute the maximum size (weakly) stable matching to allocate residents to hospitals [11]. We argue that another natural solution could be the matching which has the highest probability of being stable after conducting a lottery. Alternatively, there may be a cost associated with eliciting preferences from the agents, so a central planner may want to only obtain and provide a recommendation based on a subset of the complete orders [2].
As another example, imagine a group of interns are admitted to a company and allocated to diﬀerent projects based on their preferences and the preferences of the project leaders. Suppose that after three months the interns can switch projects if the project leaders agree; though the company would prefer not to have swaps if possible. However, both the interns and the project leaders can have better information about each other after the three months, and the assignment should also be stable with regard to the reﬁned preferences. This example motivates our lottery and joint probability models. In the lottery model, the agents have independent probabilities over possible linear orders (e.g. each project leader has a probability distribution on possible reﬁned rankings over the interns independently from each other). In the joint probability model, the probability distribution is over possible preference proﬁles and can thus accommodate the possibility that the preferences of the agents are reﬁned in a correlated way (e.g. if an intern performs well in the ﬁrst three months then she is likely to be highly ranked by all project leaders). Uncertainty in preferences has already been studied in voting [8] and for cooperative games [10]. Ehlers and Mass´o [3] considers many-to-one matching markets under a Bayesian setting. Similarly, in auction theory, it is standard to examine Bayesian settings in which there is a probability distribution over the types of agents.
To illustrate the problem we describe a simple example with four agents. We write b ≻ac to say that agent a prefers b to c and assume the lottery model.
Example 1. We have two men m1 and m2 and two women w1 and w2. Each agent assigns a probability to each strict preference ordering as follows. (i) p(w1≻m1 w2) = 0.4 and p(w2≻m1 w1) = 0.6 (ii) p(w1≻m2 w2) = 0.0 and p(w2≻m2 w1) = 1.0 (iii) p(m1≻w1 m2) = 1.0 and p(m2≻w1 m1) = 0.0 (iv) p(m1≻w2 m2) = 0.8 and p(m2≻w2m1) = 0.2. This setting admits two match-
2

ings that are stable with positive probability: µ1 = {(m1, w1), (m2, w2)} and µ2 = {(m1, w2), (m2, w1)}. Notice that if each agent submits the preference list that s/he ﬁnds most likely to be true, then the setting admits a unique stable matching that is µ2. The probability of µ2 being stable, however, is 0.48 whereas the probability of µ1 being stable is 0.52.
1.1 Uncertainty Models
We consider three diﬀerent uncertainty models:
– Lottery Model: For each agent, we are given a probability distribution over strict preference lists.
– Compact Indiﬀerence Model: Each agent reports a single weak preference list that allows for ties. Each complete linear order extension of this weak order is assumed to be equally likely.
– Joint Probability Model: A probability distribution over preference proﬁles is speciﬁed.
Note that for the Lottery Model and the Joint Probability Model the representation of the input preferences can be exponentially large. However, in settings where similar models of uncertainty are used, including resident matching [2] and voting [8], a limited amount of uncertainty (i.e. small supports) is commonly expected and observed in real world data. Consequently, we consider special cases when the uncertainty is bounded in certain natural ways including the existence of only a small number of uncertain preferences and/or uncertainty on only one side of the market.
Observe that the compact indiﬀerence model can be represented as a lottery model. This is a special case of the lottery model in which each agent expresses a weak order over the candidates (similar to the SMT setting [6, 11]). However, the lottery model representation can be exponentially larger than the compact indiﬀerence model; for an agent that is indiﬀerent among n agents on the other side of the market, there are n! possible linearly ordered preferences.
1.2 Computational Problems
Given a stable marriage setting where agents have uncertain preferences, various natural computational problems arise. Let stability probability denote the probability that a matching is stable. We then consider the following two natural problems for each of our uncertainty models.
– MatchingWithHighestStabilityProbability: Given uncertain preferences of the agents, compute a matching with the highest stability probability.
– StabilityProbability: Given a matching and uncertain preferences of the agents, what is the stability probability of the matching?
3

Problems

Lottery Model

Compact Indiﬀerence

Joint Probability

StabilityProbability

#P-complete

?

in P

in P for all three models if 1 side is certain

IsStabilityProbabilityNon-Zero

NP-complete in P

in P

IsStabilityProbabilityOne

in P

in P

in P

ExistsPossiblyStableMatching ExistsCertainlyStableMatching

in P

in P

in P

in P

in P

NP-complete

?

NP-hard

NP-hard

MatchingWithHighestStabilityProb in P for all models if 1 side is certain and

there is O(1) number of uncertain agents

Table 1. Summary of results.

We also consider two speciﬁc problems that are simpler than StabilityProbability: (1) IsStabilityProbabilityNon-Zero — For a given matching, is its stability probability non-zero? (2) IsStabilityProbabilityOne — For a given matching, is its stability probability one?
We additionally consider problems connected to, and more restricted than, MatchingWithHighestStabilityProbability: (1) ExistsCertainlyStableMatching — Does there exist a matching that has stability probability one? (2) ExistsPossiblyStableMatching — Does there exist a matching that has non-zero stability probability?
Note that ExistsPossiblyStableMatching is straightforward to answer for any of the three uncertainty models we consider here, since there exists a stable matching for each deterministic preference proﬁle that is a possible realization of the uncertain preferences.
1.3 Results
Table 1 summarizes our main ﬁndings. Note that the complexity of each problem is considered with respect to the input size, and that under the lottery and joint probability models the size of the input could be exponential in n, namely O(n! · 2n) for the lottery model and O((n!)2n) for the joint probability model, where n is the number of agents on either side of the market.
We point out that StabilityProbability is #P-complete for the lottery model even when each agent has at most two possible preferences, but in P if one side has certain preferences. Additionally, we show that IsStabilityProbabilityNon-Zero is in P for the lottery model if each agent has at most two possible preferences. Note that StabilityProbability is open for the compact indiﬀerence model when both sides may be uncertain, and we also do not know the complexity of MatchingWithHighestStabilityProbility in the lottery model, except when only a constant number of agents are uncertain on the same side of the market.

4

2 Preliminaries
In the Stable Marriage problem, there are two sets of agents. Let M denote a set of n men and W a set of n women. We use the term agents when making statements that apply to both men and women, and the term candidates to refer to the agents on the opposite side of the market to that of an agent under consideration. Each agent has a linearly ordered preference over the candidates. An agent may be uncertain about his/her linear preference ordering. Let L denote the uncertain preference proﬁle for all agents. We denote by I = (M, W, L) an instance of a Stable Marriage problem with Uncertain Linear Preferences (SMULP).
We say that a given uncertainty model is independent if any uncertain preference proﬁle L under the model can be written as a product of uncertain preferences La for all agents a, where all La’s are independent. Note that the lottery and the compact indiﬀerence models are both independent, but the joint probability model is not.
A matching µ is a pairing of men and women such that each man is paired with at most one woman and vice versa; deﬁning a list of (man, woman) pairs (m, w). We use µ(m) to denote the woman w that is matched to m and µ(w) to denote the match for w. Given linearly ordered preferences, a matching is stable if there is no pair (m, w) not in µ where m prefers w to his current partner in µ, i.e., w ≻m µ(m), and vice versa. If such a pair exists, it constitutes a blocking pair ; as the pair would prefer to defect and match with each other rather than stay with their partner in µ. Given an instance of SMULP, a matching is certainly stable if it is stable with probability 1.
The following extensions of SM will come in handy in proving our results. The Stable Marriage problem with Partially ordered lists (SMP) is an extension of SM in which agents’ preferences are partial orders over the candidates. The Stable Marriage problem with Ties (SMT) is a special case of SMP in which incomparability is transitive and is interpreted as indiﬀerence. Therefore, in SMT each agent partitions the candidates into diﬀerent ties (equivalence classes), is indiﬀerent between the candidates in the same tie, and has strict preference ordering over the ties. In some practical settings some agents may ﬁnd some candidates unacceptable and prefer to remain unmatched than to get matched to the unacceptable ones. SMP with Incomplete lists (SMPI) and SMT with Incomplete lists (SMTI) captures these scenarios where each agent’s partially ordered list contains only his/her acceptable candidates. A matching is superstable in an instance of SMPI if it is stable w.r.t. all linear extensions of the partially ordered lists.
We deﬁne the certainly preferred relation ≻caert for agent a. We write b ≻caert c if and only if agent a prefers b over c with probability 1. Based on the certainly preferred relation, we can deﬁne a dominance relation D: Dm(w) = {w} ∪ {w′ : w′ ≻cmert w}; Dw(m) = {m} ∪ {m′ : m′ ≻cwert m}. Based on the notion of the dominance relation, we present a useful characterization of certainly stable matchings for independent uncertainty models.
5

Lemma 1. A matching µ is certainly stable for an independent uncertainty model if and only if for each pair {m, w}, µ(m) ∈ Dm(w) or µ(w) ∈ Dw(m).

Proof. Assume that there exists a pair {m, w} such that µ(m) ∈/ Dm(w) or

µ(w) ∈/ Dw(m). Then, m has non-zero probability of preferring w over µ(m) and

w has non-zero probability of preferring m over µ(w). But this means that µ has

non-zero probability of not being stable.

Assume that a matching µ is certainly stable. Then no blocking pair {m, w}

has non-zero probability of forming. This is only possible if the pair {m, w} is

part of the matching or one of m and w have zero probability of preferring the

blocking {m, w} over their current match in µ. In either case, µ(m) ∈ Dm(w) or

µ(w) ∈ Dw(m).

⊓⊔

We point out that certainly preferred relation can be computed in polynomial time for all three models studied in this paper.
Certainly stable matchings are closely related to the notion of super-stable matchings [5, 9]. In fact we can deﬁne a certainly stable matching using a terminology similar to that of super-stability. Given a matching µ and an unmatched pair {m, w}, we say that {m, w} very weakly blocks (blocks) µ if µ(m) ≻cmert w and µ(w) ≻cwert m. The next claim then follows from Lemma 1.

Proposition 1. A matching µ is certainly stable for an independent uncertainty model if and only if it admits no very weakly blocking pair.

3 General Results
In this section, we ﬁrst show that the complexity of all problems that we study are the same for complete and incomplete lists. We then present some general results that apply to multiple uncertainty models. We show that ExistsCertainlyStableMatching can be solved in polynomial time for any independent uncertainty model including lottery and compact indiﬀerence. We then prove that, when the number of uncertain agents is constant and one side of the market is certain, we can solve MatchingWithHighestStabilityProbability eﬃciently for each of the linear models.

3.1 The Case for Incomplete Lists
The next proposition explains that our eﬃcient algorithms described for the case of complete lists can be extended to incomplete lists. Additionally, our hardness proofs for incomplete lists can be transformed for complete lists. In fact, all our hardness reductions, except Theorem 9, are for complete lists so they trivially extend to the case of incomplete lists.
Proposition 2. The complexity of each computational problem studied in this paper are the same for complete and incomplete lists. Formally, if I is a linear model with incomplete lists then we can construct an instance I′ with complete

6

lists such that for each matching µ in I there exists a corresponding matching µ′ in I′ with p(µ, I) = p(µ′, I′), such that µ can be obtained from µ′ in polynomial time. Furthermore, µ is one of the most stable matchings in I if and only if the corresponding matching µ′ is one of the most stable matching in I′. Therefore a polynomial time algorithm solving StabilityProbability or MatchingWithHighestStabilityProbability for complete lists can be used to solve the same problem for incomplete lists in polynomial time.

Proof. In the case of complete lists we assumed that we have an equal number

of men and women and everybody ﬁnds all candidates acceptable. When we

consider the problem with incomplete lists we mean that the sizes of the two

sets are not necessarily the same and not all the candidates are acceptable for

the agents. However, we assume that in all realization of the preference proﬁles

the same candidates are acceptable, so we only randomize on the preferences

over the acceptable partners. Suppose that I is an instance of a probabilistic

model with incomplete lists with sets M and W . Let us create the corresponding

instance I′ with sets M ′ and W ′ in the following way. First we ensure that

|M ′| = |W ′| by adding enough agents to the short side of the market. Then we

complete the preference lists of each agent by adding the previously unacceptable

candidates to the end of her/his list according to a predetermined order, e.g. by

the indices of the agents. Suppose now that µ is a matching in I and X is the set

of matched men in M , whilst µ(X) = Y . Let us create a corresponding matching

µ′ in I′ by extending µ with the unique stable matching for the subinstance

restricted to the unmatched agents. Namely, let µu be the stable matching that

matches M ′ \ X to W ′ \ Y in such a way that the kth pair contains the kth

man and the kth woman from M ′ \ X and W ′ \ Y , respectively according to

their indices, and let µ′ = µ ∪ µu. Now we claim that p(µ, I) = p(µ′, I′). This

is because there is no blocking pair in (M ′ \ X) × (W ′ \ Y ), and any other pair

is blocking for some preference proﬁle in I if and only if it is blocking for the

corresponding preference proﬁle in I′, obviously. Furthermore, it is also clear

that among the extensions of µ, µ′ is the most stable one in I′. Therefore µ is

one of the most stable matchings in I if and only if the corresponding extension,

µ′ is one of the most stable matchings in I′. Thus an eﬃcient algorithm for

StabilityProbability or MatchingWithHighestStabilityProbability

(or other subproblems) for complete lists can also be used to solve the same

problems for the case of incomplete lists. This also implies that any hardness

result proved for incomplete lists holds also for complete lists.

⊓⊔

3.2 An Algorithm for the Lottery and Compact Indiﬀerence Models
Theorem 1. For any independent uncertainty model in which the certainly preferred relation is transitive and can be computed in polynomial time, ExistsCertainlyStableMatching can be solved in polynomial time.
Proof. We prove this by reducing ExistsCertainlyStableMatching to the problem of deciding whether an instance of SMP admits a super-stable matching

7

or not. The latter problem can be solved in polynomial time using algorithm

SUPER-SMP in [13].

Let I = (M, W, L) be an instance of ExistsCertainlyStableMatching

under an independent uncertainty model, assuming that the certainly preferred

relation is transitive and can be computed in polynomial time. We construct an

instance I′ = (M, W, p) of SMP, in polynomial time, as follows. The set of men

and women are unchanged. To create the partial preference ordering pa for each

agent a we do the following. W.l.o.g. assume that a is a man m. For every pair

of women w1 and w2 (i) if w1 ≻cmertain w2 then (w1, w2) ∈ pm, denoting that m (strictly) prefers w1 to w2 in I′, (ii) if w2 ≻cmertain w1 then (w2, w1) ∈ pm,

denoting that m (strictly) prefers w2 to w1 in I′. We claim, and show, that I′

admits a super-stable matching if and only if I admits a matching with stability

probability one. A matching µ is super-stable in I′ if and only if it does not

admit a very weak blocking pair. A pair (m, w) unmatched in µ is a very weak

blocking pair if (i) m either prefers w to µ(m) or is indiﬀerent between them,

and (ii) w either prefers m to µ(w) or is indiﬀerent between them. Agent a is

indiﬀerent between agents b and c under an SMP instance if neither (b, c) nor

(c, b) is in pa. It is easy to verify that an unmatched pair (m, w) in I′ is a very

weak blocking pair in µ if and only if (µ(m), w) ∈/ pm and (µ(w), m) ∈/ pw.

Only if part: If I′ admits a super-stable matching µ then µ is certainly stable

in I. Assume for a contradiction that µ is not certainly stable in I. It then follows

Lemma 1 that µ(m) ∈/ Dm(w) and µ(w) ∈/ Dw(m), implying that µ(m) ≻smtrict w and µ(w) ≻swtrict m, and thus (µ(m), w) ∈/ pm and (µ(w), m) ∈/ pw. Therefore

(m, w) blocks µ in I′, a contradiction.

If part: If I admits a certainly stable matching µ then µ is super-stable in

I′. Assume, for a contradiction, that µ is not super-stable in I′. Therefore there

exists a very weak blocking pair (m, w), implying that (µ(m), w) ∈/ pm and

(µ(w), m) ∈/ pw, which in turn implies that µ(m) ≻smtrict w and µ(w) ≻swtrict m.

The latter statement, coupled with the fact that m and w are not matched

together, implies that µ(m) ∈/ Dm(w) and µ(w) ∈/ Dw(m), and thus by Lemma

1 µ is not stable in I, a contradiction.

⊓⊔

3.3 An Algorithm for a Constant Number of Uncertain Agents
Theorem 2. When the number of uncertain agents is constant and one side of the market is certain then MatchingWithHighestStabilityProbability is polynomial-time solvable for each of the linear models.
Proof. Let I = (M, W, L) be an instance of MatchingWithHighestStabilityProbability and let X ⊆ M be the set of uncertain agents with |X| = k for a constant k. We consider all the possible matchings between X and W , where their total number is K = n(n − 1) . . . (n − k). Let µi be such a matching for i ∈ {1 . . . K}. The main idea of the proof is to show that there exist an extension of µi to M ∪ W that has stability probability at least as high as any other extension of µi. In this way we will need to compute this probability for only a

8

polynomial number of matchings in n, that we can do eﬃciently for each model,

and then compare them and select the one with the highest probability.

So we take a matching µi between sets X and W . Let Y = µi(X) (i.e., the

partners of X in W ) and let M ′ = M \ X and W ′ = W \ Y . First, we compute

the man-optimal matching µM i for the sub-instance I′ on M ′ ∪ W ′, that can be

done eﬃciently by the Gale-Shapley algorithm [4]. Now, if there exist a blocking

pair {m′, w} involving some certain agents m ∈ M ′ and w ∈ Y for µ ∪ µM i in I,

then we can conclude that any extension of µi for I will have zero probability

of being stable. This is because any extension of µi for I that has a positive

probability of being stable must also be stable for the sub-instance I′. If {m′, w}

is a blocking pair for µM i then it will remain blocking for any extension of µi for

I as well, since w has the same partner and the m′ cannot have a better partner

either. Thus we can exclude the extensions of µi from the further consideration

in this case.

Suppose now that there is no blocking pair of the form {m′, w}, as explained

above, for µM i in I. We truncate the preference lists of men in M ′ in the following

way. For each man m′ ∈ M ′ we remove all the women w′ ∈ W ′ from the list

of m′ that are less preferred by m′ than some woman in Y that ﬁnds m′ better

than her partner in µi. That is, we remove w′ from the list of m′ if there exists

w ∈ Y such that m′ ≻w µi(w) and w ≻m′ w′. Let us denote the sub-instance

for M ′ ∪ W ′ with the truncated lists as Iir. Now we compute the woman-optimal matching, µW i in Iir. Let µ∗i = µi ∪ µW i be the extended matching in I. This is

stable for the certain agents by the construction.

Finally, we will show that for any matching µ′i, that is an extension of µi to

I, the stability probability of µ′i is less than, or equal to, the stability probability

of µ∗i . If µ′i is not stable for the certain agents then µ′i has zero probability of

being stable, thus the statement holds. If µ′i is stable for the certain agents then it must also be stable in Iir, and each woman in W ′ weakly prefers her partner in µ∗i to her partner in µ′i, since she gets her optimal stable partner for Iir in µ∗i .

Therefore, if µ′i is stable under a preference proﬁle then µ∗i will also be stable,

so the statement follows. Thus, there remain only a polynomial number (K)

of candidate matchings in n for which we have to compute the probabilities.

StabilityProbability is polynomial-time solvable for all the three models we

consider given that one side has certain preferences, as described in Theorems

3, 8, and 10.

⊓⊔

4 Lottery Model
In this section we focus on the lottery model.
Theorem 3. For the lottery model, if one side has certain preferences, StabilityProbability is polynomial-time solvable.
Proof. Without loss of generality, assume that men have certain preferences. The following procedure gives us the stability probability of µ for any given µ. (1) For each uncertain woman w identify those preferences that allow her not

9

to form a blocking pair. We can do this in polynomial time as men have strict

preferences and therefore for each preference ordering of w we only need to look

up the (one and only) preference ordering of each m who w prefers to µ(w). (2)

For each uncertain woman w, add up the probabilities of all preference orderings

that pass the test in the ﬁrst step. (3) multiply the added-up probabilities for

all w obtained in step (2).

⊓⊔

Theorem 4. For the lottery model, IsStabilityProbabilityOne can be solved in linear time.

Proof. The problem is equivalent to checking whether the given matching µ

has non-zero probability of not being stable. This can be checked as follows. For

each possible pair of agents {m, w} that are not matched to each other, we check

whether they can form a blocking pair with non-zero probability. For this, we

just need to check whether m prefers w in some possible preference over µ(m)

and whether w prefers m in some possible preference over µ(w).

⊓⊔

Theorem 5. For the lottery model, IsStabilityProbabilityNon-Zero is polynomial-time solvable when each agent has at most two possible preference orderings.

Proof. The problem is to decide whether there is some preference ordering for

each agent (among the ones in their lottery) such that the given matching is

stable. If each agent has at most two possible preference orderings in their lottery,

we can reduce the problem to an instance ϕ of 2SAT, as follows.

Let {a1, . . . , an} and {b1, . . . , bn} be the two sets of agents. Moreover, for

each agent c and each i ∈ {1, 2}, let pref(c, i) denote the i-th preference in the

lottery for agent c.

We introduce a propositional variable for each preference pref(c, i)—which

we also call pref(c, i). Intuitively, these variables indicate which preference for

the agents we choose to make the matching stable.

For each agent c, we add the following clauses to ϕ, to ensure that for each

agent c there is exactly one preference that is selected: (pref(c, 1)∨pref(c, 2)) ∧

(¬pref(c, 1) ∨ ¬pref(c, 2)).

Then, we add clauses to ensure that the selected matching is stable.

For each agent c and each i ∈ {1, 2}, let Bc,i be the set of prefer-

ences pref(c′, i′)—for c′ = c and i′ ∈ {1, 2}—such that pref(c, i) and pref(c′, i′)

together lead to the given matching being unstable (with (c, c′) being a block-

ing pair). Then, for each c, i, we add the following clauses: (¬pref(c, i) ∨

¬pref(c′, i′)) for each pref(c′, i′) ∈ Bc,i.

The given matching is then stable if and only if ϕ is satisﬁable. Since ϕ is a

2CNF, this can be decided in linear time.

⊓⊔

Theorem 6. For the lottery model, StabilityProbability is #P-complete, even when each agent has at most two possible preferences.

10

Proof. We show how to count the number of satisfying assignments for a 2CNF
formula using the problem StabilityProbability for the lottery model where
each agent has two possible preferences. Since this problem is #P-hard, we get #P-hardness also for StabilityProbability.
Let ϕ be a 2CNF formula over the variables x1, . . . , xn. We ﬁrstly transform ϕ to a 2CNF formula ϕ′ over the variables x1, . . . , xn, y1, . . . , yn that has exactly the same number of satisfying assignments, and that satisﬁes the prop-
erty that each clause contains one variable among x1, . . . , xn and one variable among y1, . . . , yn. We do so as follows. Firstly, for each 1 ≤ i ≤ n, we add the clauses (¬xi ∨ yi) and (¬yi ∨ xi), ensuring that in each satisfying assignment the variables xi and yi get assigned the same truth value. Then, for each clause of ϕ, we replace one occurrence of a variable among x1, . . . , xn by the corresponding variable among y1, . . . , yn, and we add the resulting clause to ϕ′. For example, if ϕ contains the clause (x1 ∨ ¬x3), we would add the clause (x1 ∨ ¬y3) to ϕ′. It is readily veriﬁed that ϕ′ has the same number of satisfying assignments as ϕ.
Moreover, we may assume without loss of generality that for any two variables of ϕ′, there is at most one clause of ϕ′ that contains both of these variables. If in ϕ there are two variables x1 and x2 and clauses (x1 ∨ x2) and (¬x1 ∨ ¬x2), for instance, we can construct ϕ′ to contain the clauses (x1 ∨ y2) and (¬y1 ∨ ¬x2).
We now construct an instance of StabilityProbability. The sets of agents that we consider are {x1, . . . , xn, a1, . . . , an} and {y1, . . . , yn, b1, . . . , bn}. The matching that we consider matches xi to bi and matches yi to ai, for each 1 ≤ i ≤ n. This is depicted below. Each agent bi has only a single possible preference, namely one where they prefer xi over all other agents. Similarly, each agent ai has a single possible preference where they prefer yi over all other agents. In other words, the agents ai and bi are perfectly happy with the given matching. The agents xi and yi each have two possible preferences, that are each chosen

b1 b2 b3

bn

•••

•

···

•••

•

x1 x2 x3

xn

y1 y2 y3

yn

•••

•

···

•••

•

a1 a2 a3

an

with probability 12 . These two possible preferences are associated with setting these variables to true or false, respectively. We describe how these preferences
are constructed for the agents xi. The construction for the preferences of the agents yi is then entirely analogous.
Take an arbitrary agent xi. We show how to construct the two possible preferences for agent xi, which we denote by pxi and p¬xi. Both of these possible preferences are based on the following partial ranking: b1 > b2 > · · · > bn, and we add some of the agents y1, . . . , yn to the top of this partial ranking, and the remaining agents to the bottom of this partial ranking.

11

To the ranking pxi we add exactly those agents yj to the top where ϕ′ contains

a clause (¬xi ∨ yj) or a clause (¬xi ∨ ¬yj). All remaining agents we add to the

bottom. Similarly, to the ranking p¬xi we add exactly those agents yj to the

top where ϕ′ contains a clause (xi ∨ yj) or a clause (xi ∨ ¬yj). The rankings pyi

and p¬yi, for the agents yi, are constructed entirely similarly.

Now consider a truth assignment α : {x1, . . . , xn, y1, . . . , yn} →

{0, 1}, and consider the corresponding choice of preferences for the

agents x1, . . . , xn, y1, . . . , yn, where for each agent xi the preference pxi is chosen

if and only if α(xi) = 1, and for each agent yi the preference pyi is chosen if

and only if α(yi) = 1. Then α satisﬁes ϕ′ if and only if the corresponding choice

of preferences leads to the matching being stable. Since each combination of

preferences is equally likely to occur, and there are 22n many combinations of

preferences,

the

probability

that

the

given

matching

is

stable

is

exactly

q

=

s 22n

,

where s is the number of satisfying truth assignments for ϕ. Therefore, given q, s

can be obtained by computing s = q22n.

⊓⊔

If each agent is allowed to have three possible preferences, then even the following problem is NP-complete. The statement can be proved via a reduction from Exact Cover by 3-Sets (X3C).

Theorem 7. For the lottery model, IsStabilityProbabilityNon-Zero is NP-complete.

Proof. The problem is in NP, since we only need to provide one proﬁle that occurs
with non-zero probability for which the given matching is stable. We show NP-
hardness by giving a reduction from Exact Cover by 3-Sets (X3C). Let (X, C)
be an instance of X3C, where |X| = 3n for some n, and C = {c1, . . . , cm} is a collection of sets ci ⊆ X, each of size 3. Moreover, let ci = {xℓi,1 , xℓi,2 , xℓi,3 }, for each 1 ≤ i ≤ m. The problem is to decide whether there is a subset C′ ⊆ C of
size exactly n such that C′ = X.
We construct an instance of our problem as follows. We let {a1, . . . , an, a′1, . . . , a′3n} and {b1, . . . , bn, b′1, . . . , b′3n} be the two sets of agents, we match ai to bi—for each 1 ≤ i ≤ n— and we match a′j to b′j—for each 1 ≤ j ≤ 3n. This is depicted below.

a1

a2

a3

an

•

•

•

•

···

•

•

•

•

b1

b2

b3

bn

a′1

a′2

a′3

a′3n

•

•

•

•

···

•

•

•

•

b′1

b′2

b′3

b′3n

Fig. 1. Illustration of the reduction

12

Each agent ai prefers their matching to bi over any other possible match, i.e.,
agent ai has one preference, where bi is ranked ﬁrst, and the rest of the agents
appear in some ﬁxed order after bi.
Similarly, each agent b′j prefers their matching to a′j over any other possible match. That is, agent b′j has one preference ordering in which a′j is ranked ﬁrst and the rest of the agents appear in some ﬁxed order after a′j.
Then, for each agent bi, we add the following |C| possible preferences to the
lottery:

Pi,1 : Pi,2 :
Pi,m :

a′ℓ1,1 > a′ℓ1,2 > a′ℓ1,3 > ai > · · ·

a′ℓ2,1 > a′ℓ2,2 > a′ℓ2,3 > ai > · · ·

...

a′
ℓm,1

>

a′
ℓm,2

>

a′
ℓm,3

>

ai

>

···

where in each preference the remaining agents appear in any (ﬁxed) order af-
ter ai. In other words, bi prefers three agents a′j to their current match, and these three form some set c ∈ C.
Finally, for each agent a′j, we add the following n possible preferences to the lottery:

Pj′,1 : Pj′,2 : Pj′,3 :
...
Pj′,n :

b2 > · · · > bn > b′j > b1 > b′1 > · · · > b′j−1 > b′j+1 > · · · > b′3n b1 > b3 > · · · > bn > b′j > b2 > b′1 > · · · > b′j−1 > b′j+1 > · · · > b′3n b1 > b2 > b4 > · · · > bn > b′j > b3 > b′1 > · · · > b′j−1 > b′j+1 > · · · > b′3n
...
b1 > · · · > bn−1 > b′j > bn > b′1 > · · · > b′j−1 > b′j+1 > · · · > b′3n

That is, each agent a′j prefers each of the agents b1, . . . , bn, except one, to their current match (and they never prefer any of the agents b′j′ for j′ = j over their current match).
We can show that there is a choice of preferences for the agents that makes
this matching stable if and only if (X, C) ∈ X3C.
(⇒) Firstly, suppose that there is a choice of preferences for the agents that
makes this matching stable. That is, for each agent bi there is some preference
ordering Pi,ℓi , and for each agent a′j there is some preference ordering Pj′,kj , such that these orderings (together with the ﬁxed preference orderings for the
agents ai and b′j) make this matching stable. Now, consider the set C′ = {cℓ : i ∈ [n], ℓ = ℓi}. We show that C′ = X. To derive a contradiction, suppose that this is not the case, that is, suppose that C′ = X. Then, since |C′| =
n, |X| = 3n and for each c ∈ C′ it holds that |c| = 3, we know that there must
be some cℓ, cℓ′ ∈ C′ such that cℓ ∩ cℓ′ = ∅. Say that xj ∈ cℓ ∩ cℓ′ . Therefore, there must be some i, i′ ∈ [n] such that both bi and bi′ prefer a′j over their current match. On the other hand, a′j will prefer either bi or bi′ over their current match. Therefore, either bi and a′j or bi′ and a′j will form a blocking pair. Thus, the matching is not stable. From this we can conclude that C′ = X.

13

(⇐) Conversely, suppose that there exists some C′ ⊆ C of size exactly n such

that C′ = X. Let C′ = {cℓ1, . . . , cℓn }. Now, for each agent bi we pick some

preference ordering, and for each agent a′j we pick some preference ordering,

such that these orderings (together with the ﬁxed preference orderings for the

agents ai and b′j) make the matching stable. For each agent bi, we pick the pref-

erence ordering Pi,ℓi , and for each agent a′j we pick the preference ordering Pj′,kj ,

where kj ∈ [n] is the unique value such that xj ∈ cℓkj . It is straightforward to

verify that these preferences make the matching stable.

⊓⊔

We obtain the ﬁrst corollary from Theorem 7 and the second from [16, Proposition 8] and Theorem 7.

Corollary 1. For the lottery model, unless P = NP, there exists no polynomialtime algorithm for approximating StabilityProbability of a given matching.

Corollary 2. For the lottery model, unless NP = RP, there is no FPRAS for StabilityProbability.

5 Compact Indiﬀerence Model

The compact indiﬀerence model is equivalent to assuming that we are given an instance of SMT and each linear order over candidates (each possible preference ordering) is achieved by breaking ties independently at random with uniform probabilities. It is easy to show that IsStabilityProbablityNonZero, IsStabilityProbablityOne, and ExistsCertainlyStableMatching are all in P.

Proposition 3. For the compact indiﬀerence model, IsStabilityProbabilityNonZero is in P.

Proof. This is equivalent to checking whether a given matching µ is weakly stable

in the given SMTI instance. To check this we only have to look for a blocking

pair, which can be done in polynomial time: take every possible pair (m, w) who

are not matched together and check whether they both strictly prefer each other

to their current partner.

⊓⊔

Proposition 4. For the compact indiﬀerence model, IsStabilityProbabilityOne is in P.

Proof. The problem is polynomial-time solvable. We go through all the blocking

pairs and check if any blocking pair is feasible. For each blocking pair, we break

ties (if there are any) in favour of the blocking pair. Given that we break ties in

favour of the blocking pairs, if there exists a blocking pair that is feasible, the

stability probability is not one.

⊓⊔

Proposition 5. For the compact tainlyStableMatching is in P.

indiﬀerence

model,

ExistsCer-

14

Proof. Deciding whether there is matching that is stable with probability one is equivalent to deciding whether there is a matching that is stable w.r.t. all reﬁnements, a super-stable matching. Given an instance of SMTI one can decide in polynomial time whether it admits a super-stable matching or not [12]. ⊓⊔

We do not yet know the complexity of computing the stability probability of a given matching under the compact indiﬀerence model, but this problem can be shown to be in P if one side has certain preferences.
Theorem 8. In the compact indiﬀerence model, if one side has certain preferences, StabilityProbability is polynomial-time solvable.

Proof. Assume, w.l.o.g., that men have certain preferences. The following pro-

cedure gives us the stability probability of any given matching µ. (1) For each

uncertain woman w identify those men with whom she can potentially form a

blocking pair. That is, those m such that w≻mµ(m) and w is indiﬀerent between

m and her partner in µ. Assume there are k of such men. The probability of w

not forming a blocking pair with any men is then k+1 1 . (2) Multiply the proba-

bilities from step 1.

⊓⊔

We next show that MatchingWithHighestStabilityProbability is NP-

hard. For an instance I of SMT and matching µ, let p(µ, I) denote the probability

of µ being stable, and let pS(I) = max{p(µ, I)|µ is a matching in I}, that is the

maximum probability of a matching being stable. A matching µ is said to be

weakly stable if there exists a tie-breaking rule where µ is stable. Therefore a

matching µ has positive probability of being stable if and only if it is weakly

stable. Furthermore, if the number of possible tie-breaking is N then any weakly

stable

matching

has

a

probability

of

being

stable

at

least

1 N

.

An extreme case occurs if we have one woman only with n men, where the

woman is indiﬀerent between all men. In this case any matching (pair) has a

1 n

probability

of

being

stable.

An

even

more

unfortunate

scenario

is

when

we

have n men and n women, each women is indiﬀerent between all men, and each

man ranks the women in a strict order in the same way, e.g. in the order of

their indices. In this case, the probability that the ﬁrst woman picks her best

partner, and thus does not block any matching is n1 . Suppose that the ﬁrst woman picked her best partner, the probability that the second woman also picks her

best partner from the remaining n − 1 men is n−1 1 , and so on. Therefore, the

probability

that

an

arbitrary

complete

matching

is

stable

is

1 n(n−1)...2

=

n1! .

Theorem 9. For the compact indiﬀerence model MatchingWithHighestStabilityProbability is NP-hard, even if only one side of the market has uncertain agents.

Proof. For an instance I of SMTI, let opt(I) denote the maximum size of a weakly stable matching in I. Halldorsson et al. [7] showed [in the proof of Corollary 3.4] that given an instance I of SMTI of size n, where only one side of the market has agents with indiﬀerences and each of these agents has a single tie of size

15

two, and any arbitrary small positive ǫ, it is NP-hard to distinguish between the

following two cases: (1) opt(I) ≥ 212−7 ǫ n and (2) opt(I) < 192+7 ǫ n.

When

choosing

ǫ

so

that

0

<

ǫ

<

1 2

we

can

simplify

the

above

cases

to

(1) opt(I) > 5441 n, since opt(I) ≥ 212−7 ǫ n > 5441 n and (2) opt(I) < 3594 n, since

opt(I) < 192+7 ǫ n < 3594 n.

Therefore, the number of agents left unmatched on either side of the market

is less than 1534 n in the ﬁrst case and more than 1554 n in the second case. Let us now extend instance I to a larger instance of SMTI I′ as follows. Besides the

n men M = {m1, . . . , mn} and n women W = {w1, . . . , wn}, we introduce 1534 n

men

X

= {x1, . . . xk}

and

another

n 27

men

Y

= {y1, . . . yl}

and

n 27

women Z

=

{z1, . . . zl}.

Furthermore,

for

each

yj

∈

Y

,

we

introduce

n

men

Y

j

=

{

y

j 1

,

.

.

.

,

y

j n

}

.

We create the preferences of I′ as follows. The preferences of men M remain the

same. For each woman w ∈ W we append the men X and then Y at the end of

her list in the order of their indices. Each man xi ∈ X has only all the women

W in his list in the order of their indices. Furthermore, each yj ∈ Y has all the

women W ﬁrst in his preference list in the order or their indices and then zj.

Let each zj ∈ Z has yj as ﬁrst choice and then all the men Y j in one tie of

size n. Each man in Y j has only zj in his list. We will show that in case one

pS (I ′ )

≥

1 2n

,

whilst

in

case

two

pS

≤

( n1 ) 2n7 .

Therefore,

for

n

>

227,

it

is

NP-hard

to decide which of the two separate intervals contains the value pS(I′).

To show the above statement, suppose ﬁrst that we have the ﬁrst case, so

opt(I) > 4514 n and therefore less than 1534 n women are left unmatched in a maximum size weakly stable matching µ for I, denoted by Wu ⊂ W . We extend

µ to µ′ for I′ as follows. We assign all the women in Wu to men in X in the

unique stable way, namely we pair them in a mutually increasing order of their

indices. Since |X| > |Wu|, we now matched all women in W , and left some men

in X unmatched in µ′. We complete the matching by assigning yj to zj for each

j = 1, . . . , n and leaving all of the men in Y j for all j unmatched. We shall see

that no matter how we break the ties in I′, blocking pair can appear between

the original I agents only, and therefore the probability of µ′ being stable in I′

is the same as the probability of µ being stable in I. Since we have at most n

ties in I, each of length two, the number of diﬀerent tie-breakings is at most 2n,

out

of

which

at

least

one

is

stable.

Therefore

p(µ, I′)

=

p(µ, I)

≥

1 2n

.

In the second case, opt(I) < 3594 n and therefore more than 5145 n women are

left unmatched in any weakly stable matching µ for I. Let µ′ be one of the

most stable matchings in I′. First we have to note that the restriction of µ′ to

I must be weakly stable in I, since otherwise p(µ′, I′) = 0. Let Wu denote the

set of women that are not matched to any man from M in µ′. According to our

assumption |Wu| > 5145 n, whilst |X| + |Y | = 1554 n, therefore in order to avoid a certain blocking pair between Wu and X ∪Y we shall match all the men in X ∪Y

to women in Wu in the only stable way (in the order of indices, where men in

X are coming before men in Y ), an leaving some women in Wu unmatched in

µ′. However, in this case no agent zj ∈ Z can be matched to yj, and therefore,

even if there was no potential blocking pair between agents of I, the probability

that

zj

is

matched

the

best

partner

from

Yj

is

1 n

independently

for

each

zj

∈

Z.

16

Therefore the probability of µ′ being stable is at most ( n1 ) 2n7 , which completes the proof of the ﬁrst statement.

Regarding the NP-hardness of ﬁnding one of the most stable matchings, we

shall prove that we can decide between the two cases according to the number of

unmatched women in W in the restriction of µ′ to I, where µ′ is one of the most

stable matchings in I′. To see this, let Wu denote again the set of women that

are not matched to any man in M under µ′. In the ﬁrst case, when opt(I) > 5441 n,

it must be the case that |Wu| < 5145 n, since otherwise p(µ′, I) would be less than

( n1 ) 2n7

and

could

not

achieve

1 2n

,

that

is

the

minimum

value

for

pS (I ′ ),

as

shown

in the above argument. Whilst, in the second case |Wu| > 1554 n must hold, since

opt(I) < 3594 n was assumed.

⊓⊔

6 Joint Probability Model

In this section, we examine problems concerning the joint probability model.

Theorem 10. For the joint probability model, StabilityProbability can be solved in polynomial time.

Proof. The probability that a given matching is stable is equivalent to the prob-

ability weight of the preference proﬁles for which the matching is stable. This

can be checked as follows. We check the preference proﬁles for which the given

matching is stable (for one proﬁle, this can be checked in O(n2)). Then we add

the probabilities of those proﬁles for which the matching is stable. The sum of

the probabilities is the probability that the matching is stable.

⊓⊔

Corollary 3. For the joint probability model, IsStabilityProbabilityNonZero and IsStabilityProbabilityOne can be solved in polynomial time.

For the joint probability model, the problem ExistsCertainlyStableMatching is equivalent to checking whether the intersection of the sets of stable matchings of the diﬀerent preference proﬁles is empty or not.

Theorem 11. For the joint probability model, ExistsCertainlyStableMatching is NP-complete.

Proof. The problem is in NP, since computing StabilityProbability can be
done in polynomial time by Theorem 10. The NP-hardness proof is by reduction
from 3-Colorability. Let G = (V, E) be a graph specifying an instance of 3-
Colorability, where V = {v1, . . . , vn}. We construct an instance I of SMULP assuming the joint probability model.
For each vertex vi ∈ V , we introduce three men mi,1, mi,2, mi,3 and three women wi,1, wi,2, wi,3. Then, we introduce one preference proﬁle P0 that ensures that every certainly stable matching matches—for each i ∈ [n]—each mi,j to some wi,j′ and, vice versa, each wi,j to some mi,j′ , for j, j′ ∈ [3]. Moreover,

17

it ensures that for each i ∈ [n], exactly one of three matchings between the men mi,j and the women wi,j must be used:
(1) mi,1 is matched to wi,1, mi,2 is matched to wi,2, and mi,3 is matched to wi,3; (2) mi,1 is matched to wi,2, mi,2 is matched to wi,3, and mi,3 is matched to wi,1; or (3) mi,1 is matched to wi,3, mi,2 is matched to wi,1, and mi,3 is matched to wi,2;
Intuitively, choosing one of the matchings (1)–(3) for the agents mi,j, wi,j corresponds to coloring vertex vi with one of the three colors in {1, 2, 3}.
Then, for each edge e = {vi1 , vi2 } ∈ E, and for each color c ∈ {1, 2, 3}, we introduce a preference proﬁle Pe,c that ensures that in any certainly stable matching, the agents mi1,j, wi1,j and the agents mi2,j, wi2,j cannot both be matched to each other with matching (c). We let each preference proﬁle appear with non-zero probability (e.g., we take a uniform lottery over all the preference proﬁles that we introduced). As a result, any certainly stable matching directly corresponds to a proper 3-coloring of G.
A detailed description of the preference proﬁles P0 and Pe,c and a proof of correctness for this reduction follows.
In P0, for each i ∈ [n], the preferences for mi,j, wi,j are as follows:

mi,1 : mi,2 : mi,3 :

wi,1, wi,2, wi,3, − − − wi,2, wi,3, wi,1, − − − wi,3, wi,1, wi,2, − − −

wi,1 : wi,2 : wi,3 :

mi,2, mi,3, mi,1, − − − mi,3, mi,1, mi,2, − − − mi,1, mi,2, mi,3, − − −

Next, we continue with the preference proﬁles Pe,c. Take an arbitrary e = {vi1 , vi2 } ∈ E and an arbitrary c ∈ {1, 2, 3}. In Pe,c, the preferences for mi,j, wi,j for each i ∈ [n] \ {i1, i2} are exactly the same as in P0. Only the preferences for mi1,j, wi1,j and mi2,j, wi2,j diﬀer from P0; namely, we construct these preferences as follows.
For mi1,j, wi1,j, we start with preferences that (i) for all mi1,j have wi1,1, wi1,2, wi1,3 as top three choices, (ii) for all wi1,j have mi1,1, mi1,2, mi1,3 as top three choices, (iii) admit only matchings (1), (2), and (3) as stable match-
ings between the agents mi1,j, wi1,j, and (iv) for the men mi1,j the matching (c) is the worst option among the matchings (1), (2), and (3). Similarly, for mi2,j, wi2,j, we start with preferences that satisfy conditions (i), (ii) and (iii), and additionally satisfy the condition (iv′) that for the women wi2,j the matching (c) is the worst option among the matchings (1), (2), and (3). Then, we modify the pref-
erences for mi1,1 and wi2,1 slightly. For mi1,1, we insert wi2,1 between his second and third preferred woman. Similarly, for wi2,1, we insert mi1,1 between her second and third preferred man. As a result, mi1,1 and wi2,1 form a blocking pair in this preference proﬁle if both the agents mi1,j, wi1,j and the agents mi2,j, wi2,j are matched to each other using matching (c)—and not if either set of agents is
matched to each other using some other matching (c′).

18

For example, consider e = {vi1 , vi2 } and c = 2. The preferences for the agents mi1,j , wi1,j and mi2,j, wi2,j in the preference proﬁle Pe,c are as follows:

mi1,1 : mi1,2 : mi1,3 : wi1,1 : wi1,2 : wi1,3 :

wi1,1, wi1,3, wi2,1, wi1,2, − − − wi1,2, wi1,1, wi1,3, − − − wi1,3, wi1,2, wi1,1, − − − mi1,3, mi1,2, mi1,1, − − − mi1,1, mi1,3, mi1,2, − − − mi1,2, mi1,1, mi1,3, − − −

mi2,1 : mi2,2 : mi2,3 : wi2,1 : wi2,2 : wi2,3 :

wi2,2, wi2,3, wi2,1, − − − wi2,3, wi2,1, wi2,2, − − − wi2,1, wi2,2, wi2,3, − − − mi2,1, mi2,2, mi1,1, mi2,3, − − − mi2,2, mi2,3, mi2,1, − − − mi2,3, mi2,1, mi2,2, − − −

We argue that G has a proper 3-coloring if and only if there is a certainly

stable matching for the probability distribution over preference proﬁles that we

constructed.

(⇒) Firstly, suppose that G has a proper 3-coloring, say χ : V → {1, 2, 3}.

We can then construct a certainly stable matching as follows. For each i ∈ [n], we

match the agents mi,j, wi,j to each other using matching (ci), where ci = χ(vi).

Clearly, this matching is stable for P0. Moreover, because χ is a proper 3-coloring

of G, it is straightforward to verify that this matching is also stable for each Pe,c.

(⇐) Conversely, suppose that there is a certainly stable matching. We know

that in this matching, each man mi,j must be matched to some woman wi,j′ , and

vice versa, each woman wi,j must be matched to some man mi,j′ . If this were not

the case, the matching would not be stable for P0, and thus not certainly stable.

Moreover, by a similar argument, we know that for each i ∈ [n], the matching

between the men mi,j and the women wi,j must be one of the matchings (1), (2),

or (3). We can then construct a 3-coloring χ : V → {1, 2, 3} as follows. For

each i ∈ [n], we let χ(vi) = ci, where (ci) is the matching used in the certainly

stable matching to match the men mi,j and the women wi,j to each other.

We argue that χ is a proper 3-coloring of G. Suppose that this is not the

case, that is, that there is some e = {vi1 , vi2 } such that χ(vi1 ) = χ(vi2 ) = c. Now

consider the preference proﬁle Pe,c. By construction of χ, we know that in the

certainly stable matching, both the agents mi1,j, wi1,j and the agents mi2,j, wi2,j

are matched to each other using matching (c). However, then by construction

of Pe,c, mi1,1 and wi2,1 form a blocking pair in Pe,c. This is a contradiction with

our assumption that the matching we considered is certainly stable. From this,

we can conclude that χ is a proper 3-coloring of G.

⊓⊔

By modifying the proof of Theorem 11, the following can also be proved.

Corollary 4. For the joint probability model, ExistsCertainlyStableMatching is NP-complete, even when there are only 16 preference proﬁles in the lottery.

Proof. We show this by modifying the proof of Theorem 11. We know that 3Colorability is NP-hard already when restricted to graphs of degree 4 [1]. We use the reduction in the proof of Theorem 11, and we assume that the given graph G has degree 4. Then, by Vizing’s Theorem [15], we know that we can give a proper edge coloring of G that uses at most 5 colors. Moreover, we can ﬁnd

19

such an edge coloring in polynomial time. Then, since in the proof of Theorem 11,

in each preference proﬁle Pe,c with e = {vi1 , vi2 }, only the preferences for the

agents mi1,j, wi1,j, mi2,j, wi2,j diﬀer from P0, we can, for each color c ∈ {1, 2, 3},

combine the preference proﬁles Pe,c for all edges e that are colored with the same

color. This results in only 16 preference proﬁles: P0, and a preference proﬁle for

each of the 5 edge colors and each of the 3 vertex colors.

⊓⊔

7 Future work
First we note that we left open two outstanding questions, as described in Table 1. In this paper we focused on the problem of computing a matching with the highest stability probability. However, a similarly reasonable goal could be to minimize the expected number of blocking pairs. It would also be interesting to investigate some further realistic probability models, such as the situation when the candidates are ranked according to some noisy scores (like the SAT scores in the US college admissions). This would be a special case of the joint probability model that may turn out to be easier to solve. Finally, in a follow-up paper we are planning to investigate another probabilistic model that is based on independent pairwise comparisons.
Acknowledgments. Bir´o is supported by the Hungarian Academy of Sciences under its Momentum Programme (LP2016-3) and the Hungarian Scientiﬁc Research Fund, OTKA, Grant No. K108673. Rastegari was supported EPSRC grant EP/K010042/1 at the time of the submission. The authors gratefully acknowledge the support from European Cooperation in Science and Technology (COST) action IC1205. Serge Gaspers is the recipient of an Australian Research Council (ARC) Future Fellowship (FT140100048) and acknowledges support under the ARC’s Discovery Projects funding scheme (DP150101134). NICTA is funded by the Australian Government through the Department of Communications and the ARC through the ICT Centre of Excellence Program.

References
1. D. P. Dailey. Uniqueness of colorability and colorability of planar 4-regular graphs are NP-complete. Discrete Mathematics, 30(3):289–293, 1980.
2. J. Drummond and C. Boutilier. Preference elicitation and interview minimization in stable matchings. In Proceedings of the Twenty-Eighth AAAI Conference on Artiﬁcial Intelligence, pages 645–653, 2014.
3. L. Ehlers and J. Mass´o. Matching markets under (in)complete information. Journal of Economic Theory, 157:295–314, 2015.
4. D. Gale and L. S. Shapley. College admissions and the stability of marriage. The American Mathematical Monthly, 69(1):9–15, 1962.
5. D. Gusﬁeld and R. Irving. The Stable Marriage Problem: Structure and Algorithms. MIT Press, 1989.
6. D. Gusﬁeld and R. W. Irving. The stable marriage problem: Structure and algorithms. MIT Press, Cambridge, MA, USA, 1989.

20

7. M. M. Halldo´rsson, K. Iwama, S. Miyazaki, and H. Yanagisawa. Improved approximation results for the stable marriage problem. ACM Trans. Algorithms, 3(3), 2007.
8. N. Hazon, Y. Aumann, S. Kraus, and M. Wooldridge. On the evaluation of election outcomes under uncertainty. Artiﬁcial Intelligence, 189:1–18, 2012.
9. R. Irving. Stable marriage and indiﬀerence. Discrete Applied Mathematics, 48: 261–272, 1994.
10. Y. Li and V. Conitzer. Cooperative game solution concepts that maximize stability under noise. In AAAI, pages 979–985, 2015.
11. D. Manlove. Algorithmics of Matching Under Preferences. World Scientiﬁc Publishing Company, 2013.
12. D. F. Manlove. Stable marriage with ties and unacceptable partners. Technical Report TR-1999-29, University of Glasgow, Department of Computing Science, 1999.
13. B. Rastegari, A. Condon, N. Immorlica, R. Irving, and K. Leyton-Brown. Reasoning about optimal stable matching under partial information. In Proceedings of the ACM Conference on Electronic Commerce (EC), pages 431–448. ACM, 2014.
14. A. E. Roth and M. A. O. Sotomayor. Two-Sided Matching: A Study in Game Theoretic Modelling and Analysis. Cambridge University Press, 1990.
15. V. G. Vizing. On an estimate of the chromatic class of a p-graph. Diskret. Analiz, 3(7):25–30, 1964.
16. D. J. A. Welsh and C. Merino. The Potts model and the Tutte polynomial. Journal of Mathematical Physics, 41(3):1127–1152, 2000.
21

