You Impress Me: Dialogue Generation via Mutual Persona Perception
Qian Liu‚Ä†‚àó , Yihong Chen‚ô¶‚àó, Bei Chen¬ß, Jian-Guang Lou¬ß, Zixuan Chen‚ô†‚àó, Bin Zhou‚Ä†, Dongmei Zhang¬ß
‚Ä†School of Computer Science and Engineering, Beihang University, China ‚ô¶UCL Centre for ArtiÔ¨Åcial Intelligence, University College London, United Kindom
‚ô†School of Computer Science, Fudan University, China ¬ßMicrosoft Research, Beijing, China
‚Ä†{qian.liu, zhoubin}@buaa.edu.cn; ¬ß{beichen, jlou, dongmeiz}@microsoft.com; ‚ô¶yihong.chen@cs.ucl.ac.uk; ‚ô†remch183@outlook.com

arXiv:2004.05388v1 [cs.CL] 11 Apr 2020

Abstract
Despite the continuing efforts to improve the engagingness and consistency of chit-chat dialogue systems, the majority of current work simply focus on mimicking human-like responses, leaving understudied the aspects of modeling understanding between interlocutors. The research in cognitive science, instead, suggests that understanding is an essential signal for a high-quality chit-chat conversation. Motivated by this, we propose P2 BOT, a transmitter-receiver based framework with the aim of explicitly modeling understanding. SpeciÔ¨Åcally, P2 BOT incorporates mutual persona perception to enhance the quality of personalized dialogue generation. Experiments on a large public dataset, PERSONA-CHAT, demonstrate the effectiveness of our approach, with a considerable boost over the state-of-theart baselines across both automatic metrics and human evaluations.
1 Introduction
Thanks to the advance in neural models and the accessibility of massive datasets, open-domain dialogue (i.e. chit-chat) systems have made great progress towards mimicking human-like responses. Nevertheless, there still exist some serious challenges in building personalized chatbots that can deliver engaging conversations and gain user trust (Song et al., 2019). For example, current chit-chat systems tend to generate uninformative responses (Li et al., 2016b). Moreover, they are usually lack of coherent personality traits due to the fact that training dialogues actually come from a diverse set of speakers (Zhang et al., 2018b).
‚àóWork done during an internship at Microsoft Research.

Persona
I bought my first home. I love to barbecue. I live in Springfield. I‚Äôm a writer.

Persona
I weight 300 pounds. I am not healthy. I am a man. I like The Godfather.

Hello how are you, I am new to the Springfield area.
Hi! Seen any good movies lately?
I have been to the movies.
I love The Godfather, one of my favorites! Was that filmed?
I don‚Äôt believe so. I don‚Äôt watch movies more of a writer.
What do you write? Any diet books ? I am not very healthy.

Figure 1: A clippled dialogue from PERSONA-CHAT.

Several attempts have been made to alleviate the above issues. Methods like special reward shaping to reduce generic responses (Li et al., 2016b) and representing the speakers with latent variables (Li et al., 2016a) were introduced to improve the engagingness of chit-chat systems. A more straightforward approach, which equips chit-chat systems with predeÔ¨Åned personas, was proposed accompanied by a novel dataset, PERSONA-CHAT (Zhang et al., 2018b). Figure 1 shows a clipped dialogue from PERSONA-CHAT. Two interlocutors meet for the Ô¨Årst time and are having a conversation in order to get to know each other. What makes PERSONACHAT unique is that personas of both interlocutors are explicitly described using several proÔ¨Åle sentences, facilitating the training of chatbots with conÔ¨Ågurable and persistent personalities.
PERSONA-CHAT has fueled a growing interest in developing methods for personalized dialogue

Interlocutor I bought my first home. I love to barbecue. I live in Springfield. I‚Äôm a writer.
Transmitter
‚Ñ¨ is not very healthy ‚Ä¶

Latent Space

Receiver

I don‚Äôt believe so. I don‚Äôt watch movies more of a writer.
What do you write? Any diet books? I am not very healthy.

Latent Space

Receiver

Interlocutor
ùíú is a writer. ‚Ä¶
Transmitter
I weight 300 pounds. I am not healthy. I am a man. I like The Godfather.

Figure 2: The overview of P2 BOT (see text).

generation. Mazare¬¥ et al. (2018) incorporated additional data from Reddit to train the model. Wolf et al. (2019b) Ô¨Åne-tuned pretrained language model (Radford et al., 2018) to improve the dialogue generation. Although both works demonstrate promising results, they focus more on mimicking the style of human-like responses, leaving understudied the aspects of explicitly modeling understanding between interlocutors. Our work, instead, takes the perspective of understanding modeling.
According to the research in cognitive science, effective communication creates similar activation maps in the brains of both interlocutors (Hasson et al., 2012), suggesting that understanding between interlocutors is an essential signal for a highquality chit-chat conversation. For instance, in the conversation shown in Figure 1, the two interlocutors foster understanding either by raising personarelated topics, ‚ÄúSeen any good movies lately?‚Äù, or by revealing their own personas through answering questions, ‚ÄúI don‚Äôt watch movies more of a writer.‚Äù. The efforts to build understanding keep the conversation Ô¨Çowing.
Taking into account the above, we propose Persona Perception Bot (P2 BOT), explicitly modeling the understanding between interlocutors with a transmitter-receiver framework. Distinguished from traditional methods, P2 BOT highlights a novel concept, mutual persona perception, which is better suited to describe the information exchange process that empowers the interlocutors to get to know each other. In order to train P2 BOT for personalized dialogue generation, we employ supervised training and self-play Ô¨Åne-tuning piloted by reward signals characterizing mutual persona perception. Experiments on the PERSONACHAT dataset demonstrate the superiority of our approach over the baselines in both automatic met-

rics and human evaluations1.
2 Methodology Overview
The central idea of P2 BOT is to explicitly model understanding between interlocutors and enhance dialogue generation via mutual persona perception. It comprises two components, Transmitter and Receiver, respectively responsible for dialogue generation and mutual persona perception. Figure 2 gives an overview of P2 BOT: interlocutor A has a persona wA, described with L proÔ¨Åle sentences {w1A, ¬∑ ¬∑ ¬∑ , wLA}. When she Ô¨Årst meets the other interlocutor B, they are going to know each other through a N -turn dialogue (xA1 , xB1 , ¬∑ ¬∑ ¬∑ , xAN , xBN ), where xAn denotes the utterance that A says in nth turn and N denotes the number of total turns. Given the entire dialogue history up to n-th turn hAn = (xA1 , ¬∑ ¬∑ ¬∑ , xBn‚àí1), Transmitter generates xAn according to the distribution p(xAn | wA, hAn ), and transmits it to B. The same process applies to B, keeping the conversation Ô¨Çowing.
As the conversation goes on, impressions are gradually built via utterances. For example, when A says ‚ÄúI don‚Äôt watch movies more of a writer.‚Äù, the impression that ‚ÄúA is a writer.‚Äù is left on B‚Äôs mind. As mentioned above, a successful conversation helps interlocutors know each other, which means B‚Äôs impression of A should correspond to A‚Äôs persona and vice versa. Receiver aims to measure the proximity between the built impressions and the actual personas. SpeciÔ¨Åcally, as demonstrated by the dashed black lines in Figure 2, Receiver Ô¨Årst projects impressions and personas into a latent space, and then measures the relevance between them based on the impression encoding (e.g. HA, B‚Äôs impression on A, projected from A‚Äôs
1Our code is available at https://github.com/ SivilTaram/Persona-Dialogue-Generation

Transmitter

[MASK] [MASK] [MASK]

I

don‚Äôt

[EOS] IsNext

Layer 12 Block Block Block ‚Ä¶ Block Block ‚Ä¶ Block Block

‚Ä¶

‚Ä¶‚Ä¶

‚Ä¶

‚Ä¶

Layer 1 Block Block Block ‚Ä¶ Block Block ‚Ä¶ Block Block

Position Encoding

w [PS]
e

‚Ä¶
w
I bought e [SOS]

‚Ä¶
I . we [CLS]

Figure 3: The overall architecture of Transmitter. ‚ÄúBlock‚Äù is short for ‚ÄúTransformer Block‚Äù. Arrows bridge the current block to subsequent blocks of its following layer. Position encoding is to incorporate position information into block by assigning an embedding for each absolute position in the sequence. Here we omit the architecture inside the block, and refer the readers to Vaswani et al. (2017) for more details. [MASK] tokens are ignored in the training objective.

utterances xA), and persona encoding (e.g. WA, projected from A‚Äôs persona wA)2. The relevance scores serve as mutual persona perception rewards, and are further incorporated into the training of Transmitter. Details of the two components are presented in Section 3 and 4.
3 Transmitter
Following previous work (Li et al., 2016b; Zhang et al., 2018b), we treat dialogue generation as a sequence generation problem. Concretely, we employ the pretraining transformer language model introduced in Radford et al. (2018) (i.e. GPT) to initialize Transmitter. The entire training procedure consists of two steps: (1) Supervised Dialogue Generation. We optimize Transmitter via maximum likelihood estimation (MLE) on the supervised dialogue generation task. (2) Self-play Model Finetuning. We simulate dialogues between two randomly paired interlocutors, encouraging Transmitter to learn a policy that maximizes reward signals via reinforcement learning (RL) (Sutton et al., 1999). The design of the reward function considers both language modeling and our proposed mutual persona perception.
3.1 Supervised Dialogue Generation
As illustrated in Figure 3, Transmitter follows the overall architecture of 12 stacked transformer layers to encode context and generate response. Here, the context contains the persona wA, the dialogue
2We take A as an example, and all are similar to B.

history hAn , and several special tokens (e.g. [PS]

which indicates the start of persona). Given a

training

instance

(w

A

,

h

A n

,

xAn

),

the

training

ob-

jective of MLE is to maximize the conditional log-

likelihood as:

Lmle = log pŒ∏(xAn,t | wA, hAn , xAn,<t), (1)
t

where Œ∏ is the parameter of Transmitter. xAn,t means the t-th token in xAn , and xAn,<t indicates the token sequence before t-th token. Equation 1, hereafter simpliÔ¨Åed as log pŒ∏(xAn | wA, hAn ), applies to both A and B, and we mention A for the sake of brevity
(the same as below).
During inference, beam search is applied to store top-ranked response candidates {xÀÜAn }, and Transmitter subsequently chooses as prediction the one
that maximizes the length-normalized score:

A‚àó

log pŒ∏(xÀÜAn | wA, hAn )

xn = arg max A

|xÀÜA|

. (2)

xÀÜn

n

Besides the sequence generation task, inspired by Wolf et al. (2019b), we set up an auxiliary task, Next Utterance Prediction. Apart from training Transmitter to generate responses, we also train it to discriminate whether the response is the next utterance of the given context. Concretely, we append a special token [CLS] to the tail of the generated tokens. A classiÔ¨Åer is built on top of the token‚Äôs hidden state in the last transformer layer, as indicated by the red rounded rectangle in Figure 3. In training, for each response, we randomly sample a distractor and train the classiÔ¨Åer to give a higher score on the response than the distractor. In inference, the classiÔ¨Åer is used to rank response candidates together with Equation 2. Denoting as yn = 1 the signal indicating the generated response xÀÜAn is predicted as the next utterance, Equation 2 is extended as:

A‚àó

log pŒ∏(xÀÜAn | wA, hAn )

xn = arg max Œ±¬∑ A

|xÀÜA|

xÀÜn

n

(3)

+(1 ‚àí Œ±) ¬∑ log pŒ∏(yn = 1|wA, hAn , xÀÜAn ) ,

where Œ± is a hyper-parameter.
3.2 Self-play Model Fine-tuning Although supervised dialogue generation alone can be used to mimic human-like responses, it does not inherently target at understanding. Therefore, we

ùë•1ùíú ‚àó

ùíú

ùë†1‚Ñ¨

ùë†1ùíú

ùë•2ùíú ‚àó

ùë†2‚Ñ¨

ùë†2ùíú

ùë†ùëÅùíú Reward

ùìë

ùëé1‚Ñ¨

ùìë

ùëé2‚Ñ¨

ùëéùëÅ‚Ñ¨

update policy

Figure 4: The illustration of the self-play procedure. Arrows ‚áí represent the process of dialogue generation driven by Transmitter. Note that xA1 ‚àó is directly taken from the dataset as it is difÔ¨Åcult to generate high-quality
utterances without any dialogue history.

further Ô¨Åne-tune Transmitter using reinforcement learning with the goal of maximizing mutual persona perception. Analogous to Lewis et al. (2017), we apply self-play to simulate the communication between two Transmitters, both of which have been trained as described in Section 3.1.
SpeciÔ¨Åcally, we have the two Transmitters communicate with each other for several turns. One Transmitter serves as a user with the parameters frozen, while the other is a learnable agent. The parameter of the learnable agent, Œ∏, is Ô¨Åne-tuned during the self-play. Without loss of generality, in our experiments, we let interlocutor A, who starts a conversation, be the user, and correspondingly B be the learnable agent.
Here we introduce some necessary formulations for modeling our problem with reinforcement learning. A state contains the persona and the dialogue history. For example, the state for B at turn n is deÔ¨Åned as sBn = {wB, hBn }. An action aBn is the response to be generated. The action space is inÔ¨Ånitely large as the response can be arbitrary long. Taking sBn as input, the parameter Œ∏ deÔ¨Ånes a policy pŒ∏(aBn |sBn ), through which the learnable agent generates its response.
As illustrated in Figure 4, when it is B‚Äôs turn to speak, B receives sBn and picks aBn according to the policy pŒ∏. As for A, it receives sAn and generates the response xAn ‚àó to simulate a user. A and B alternately produce responses till the number of turns exceeds the given limit. Once a complete dialogue is generated, the reward is collected to optimize Œ∏ using policy gradient (Sutton et al., 1999). Denoting as R(aBn ) the reward B gets at turn n (more details are provided later), we can optimize it by maximizing the following objective:

Applying likelihood ratio trick, Œ∏ is updated by ascending the following gradient:

‚àáŒ∏Lrl = EaB‚àºp (aB|sB)‚àáŒ∏logpŒ∏(aBn |sBn )R(aBn ). (5) n Œ∏ nn

As aforementioned, the space of action aBn is inÔ¨Ånite. In practice, REINFORCE algorithm
(Williams, 1992) is leveraged to approximate Equation 5 by sampling aBn from policy pŒ∏(aBn |sBn ). Furthermore, subtracting a baseline (Weaver and Tao,
2001), here the mean reward of a mini-batch, is applied on R(aBn ) to reduce variance. The agent samples tokens one by one through multinomial sampling over the output distribution of B, until
the special token [EOS] is sampled or exceed-
ing the maximum allowed decoding step (e.g. 32).
Compared to beam search sampling, multinomial
sampling provides more diversities.

3.3 Reward Shaping (RS)
As described in Section 1, we believe that a highquality chit-chat conversation should highlight both human language modeling and mutual persona perception. Bearing this in mind, we design three rewards to address language style, discourse coherence and mutual persona perception respectively.

RS.1 Language Style The generated responses should conform to human language styles, which we believe can be evaluated by a pretrained language model (i.e. GPT). After length normalization, the score for aBn is given as:

R1(aBn ) = 1

log plm(aBn,t | aBn,<t), (6)

|aBn | t

where aBn,t and aBn,<t have similar denotation as the previously mentioned xAn,t and xAn,<t.
RS.2 Discourse Coherence The language score is evaluated individually, without considering the discourse coherence. However, a reasonable response should establish links in meaning with context, which is also an important aspect of humanlike responses. To take into account the discourse coherence, we employ the well-trained Next Utterance Predictor (mentioned in Section 3.1). The reward is given by the log probability of aBn being the next utterance of sBn :

Lrl = EaB‚àºp (aB|sB)[R(aBn )].

(4)

n Œ∏ nn

R2(aBn ) = log pŒ∏(yn = 1 | aBn , sBn ). (7)

RS.3 Mutual Persona Perception RS.1 and RS.2 only steer the agent training process towards human-like responding. They do not explicitly encourage understanding between interlocutors. Therefore, we meticulously design the reward to characterize mutual persona perception. Contrast from RS.1 and RS.2, mutual persona perception is a long-term goal throughout the whole dialogue, meaning that the effect of current action might only play out some time later. For instance, receiving ‚Äúwhat are your hobbies?‚Äù from B, it is highly likely that A‚Äôs response is relevant to A‚Äôs hobbies. This suggests that, not only A‚Äôs response but also B‚Äôs initial question contributes to mutual persona perception. Denoting as Œ≥ the discount factor indicating how far ahead B looks, the reward of mutual persona perception for aBn is deÔ¨Åned as:

N

R3(aBn ) = r(aBn )+

Œ≥2(k‚àín)‚àí1r(xAk ‚àó )

k=n+1

(8)

+ Œ≥2(k‚àín)r(aBk ) ,

where r(aBn ) is the persona perception score that B obtains in n-th turn, and r(xAk ‚àó) is deÔ¨Åned likewise. r(aBn ) can be computed using a score function:

r(aBn ) = score(aBn , wB).

(9)

In P2 BOT, the score function comes from Re-
ceiver, which will be elaborated in Section 4. The Ô¨Ånal reward R(aBn ) for aBn is a weighted sum of the rewards listed above:

R = Œª1R1 + Œª2R2 + Œª3R3,

(10)

where Œª1, Œª2 and Œª3 are hyper-parameters.

4 Receiver
Receiver is devised to measure the proximity between the built impressions and the actual personas, implemented by negative sampling. SpeciÔ¨Åcally, in training, we randomly sample a persona distractor wZ . Receiver is trained to identify the real persona wA from {wA, wZ }. In inference, for each utterance, Receiver is responsible for providing a reasonable relevance score, to model our proposed mutual persona perception. The score subsequently joins the self-play Ô¨Åne-tuning on Transmitter as part of the rewards, as in Equation 8.

Hello I I

‚Ä¶
area
‚Ä¶
movies
‚Ä¶
writer

‚Ä¶

I

Springfield

‚Ä¶

I

writer

‚Ä¶

My

games

‚Ä¶

I

StarCraft

Receiver
Impression Encoder
Persona Encoder

Aggregate

Aggregate

Loss

Figure 5: The overall architecture of Receiver (see text).

4.1 Training
As illustrated in Figure 5, Receiver contains two different encoders for impression and persona respectively. Initialized by BERT (Devlin et al., 2019), both encoders provide deep contextualized representations for each token. Then we average all the representations, yielding a Ô¨Åxed d-dimensional vector for one sentence. In this way, feeding (xA1 , xA2 , ¬∑ ¬∑ ¬∑ , xAN ) into the impression encoder consecutively, we obtain the impression encoding HA ‚àà RN√ód. The persona encoding W‚àÜ ‚àà RL√ód is produced likewise, where ‚àÜ ‚àà {A, Z}. The relevance score matrix U‚àÜ is computed via the scaled dot product (Vaswani et al., 2017):

U‚àÜ

=

HA(W‚àÜ) ‚àö

, ‚àà RN√óL.

(11)

d

In essence, Receiver is expected to capture Ô¨Åne-
grained correlations between the persona and the
dialogue. However, we do not have access to the
golden Ô¨Åne-grained correlations. The only thing we know is that, compared with WZ , HA is more correlated to WA. Since the comparison is at a coarse granularity, we gather U‚àÜ into the cumulative score c‚àÜ through an aggregate function Agg, as shown in Figure 5. To encourage cA while at the same time depress cZ , we design a marginal loss Lrec, which makes cA larger than cZ by a margin m. Moreover, considering that an utterance gener-
ally relates to zero or one proÔ¨Åle, L1 regularization is enforced to make U‚àÜ sparse. Combining all of
these, the training loss for Receiver is:

Lrec = max(0, m + cZ ‚àí cA) + Œ≤ ¬∑ |U‚àÜ|1, (12)

where Œ≤ is a hyper-parameter for penalty.
As for Agg, one straightforward way is to average over all positions of U‚àÜ. However, it maximizes every entry in UA, including all those that

Category

Model

Retrieval

KV ProÔ¨Åle Memory Dually Interactive Matching

Generative ProÔ¨Åle Memory Generative Language Model
SEQ2SEQ-ATTN

Pretrain Fintune

Lost In Conversation
Transfertransfo P2 BOT (Our)

Hits@1(%) ‚Üë
54.8 78.8
10.2 -
12.5
17.3 82.1 81.9 [0.1]

Original
ppl ‚Üì
-
35.01 50.67 35.07
17.51 15.12 [0.16]

F1(%) ‚Üë
14.25 -
16.29 16.30 16.82
17.79 19.09 19.77 [0.08]

Hits@1(%) ‚Üë
38.1 70.7
9.9 -
9.8
16.2 -
68.6 [0.2]

Revised
ppl ‚Üì
-
34.94 51.61 39.54
18.89 [0.11]

F1(%) ‚Üë
13.65 -
15.71 13.59 15.52
16.83 -
19.08 [0.07]

Table 1: Automatic evaluation results of different methods on the PERSONA-CHAT dataset. The standard deviation [œÉ] (across 5 runs) of P2 BOT is also reported. All the results were evaluated on the dev set since the test set was
not publicly available.

should not be activated (e.g. relevance scores between unrelated proÔ¨Åle sentences and utterances), introducing unnecessary noise into the training of Transmitter. To alleviate the problem, we choose to implement Agg as a controllable weighted function, which summarizes U‚àÜn,: as:

Agg(U‚àÜn,:) =

L k=1

exp(U‚àÜn,k

/œÑ

)

¬∑

U‚àÜn,k

L exp(U‚àÜ /œÑ ) , (13)

k=1

n,k

where temperature œÑ > 0 is a tunable parameter (Hinton et al., 2015) controlling the evolution of Agg. In the beginning, Agg behaves close to average pooling. As œÑ anneals, Agg gradually focuses more on the highest relevance score. In this way, noise reduces as training goes on. Finally, c‚àÜ is given by:

‚àÜ 1N

‚àÜ

c= N

Agg(Un,:).

(14)

n=1

4.2 Inference
Given xAn and wA, Receiver employs the following function to obtain xAn ‚Äôs persona perception score, further modeling mutual persona perception as in Equation 9:

A A Agg HAn,:(WA)

score(xn , w ) =

‚àö

, (15)

d

where HAn,: and WA are the impression encoding and persona encoding for xAn and wA respectively.

5 Experiment

We conducted experiments on the dataset PERSONA-CHAT, assessing P2 BOT using both au-
tomatic metrics and human evaluations. To verify

the effectiveness of our proposed mutual persona perception, we perform a thorough model analysis in Section 5.3. Finally, we probe Receiver‚Äôs capability on perceiving persona in Section 5.4.
5.1 Implementation Details
PERSONA-CHAT dataset contains 8,939 / 1,000 multi-turn dialogues conditioned on 1,155 / 100 personas for train / dev. Each persona is described with at least 5 proÔ¨Åle sentences. To make it more challenging, PERSONA-CHAT also provides revised personas by rephrasing, generalizing or specializing the original ones. For example, ‚ÄúI am overweight.‚Äù is revised from ‚ÄúI weight 300 pounds.‚Äù.
Our implementation was based on PyTorch (Paszke et al., 2019), ParlAI (Miller et al., 2017), and HuggingFace‚Äôs transformers library (Wolf et al., 2019a). We used Adam (Kingma and Ba, 2015) optimizer with a learning rate of 6.25e-5 for both Receiver and Transmitter in supervised learning. In the training of Receiver, œÑ reduced linearly from 10 to 0.5. In the self-play phase of Transmitter, the learning rate was set as 1e-6. The hyperparameters m, Œ±, Œ≤, Œ≥, Œª1, Œª2 and Œª3 were set as 0.4, 0.1, 1e-4, 0.5, 0.4, 0.1 and 0.5 respectively. The supervised training of Transmitter lasted for 2 epochs, and the self-play Ô¨Åne-tuning comprised 2000 dialogues, where the number of turns was 3. The beam search size was set as 2.
5.2 Methods Comparison
Our baselines fall into three categories: retrievalbased, generative-based and pretrain-Ô¨Ånetunebased models. Among the retrieval-based baselines, KV ProÔ¨Åle Memory (Zhang et al., 2018b) was the ofÔ¨Åcial baseline which employed the memory network along with proÔ¨Åle information, and

Model
Lost In Conversation Transfertransfo P2 BOT (Our)

1 (%)
26.3 41.7 18.9

2 (%)
48.7 25.3 26.3

3 (%)
22.0 28.7 28.6

4 (%)
3.0 4.3 26.2

Avg
2.017 1.956 2.621

Table 2: Human evaluation results.

Dually Interactive Matching Network (Gu et al., 2019) proposed a dual matching architecture to match between the responses and their corresponding contexts. Language Model, Generative ProÔ¨Åle Memory (Zhang et al., 2018b) and SEQ2SEQ with attention mechanism (Bahdanau et al., 2015) were implemented as generative baselines for dialogue generation. The remaining methods were all pretrain-Ô¨Ånetune-based. Transfertransfo (Wolf et al., 2019b)3 achieved the state-of-the-art performance on automatic metrics, while Lost In Conversation4 topped the human evaluations (Dinan et al., 2019). Analogous to our approach, they employed the pretrained language model GPT to initialize their models, and then Ô¨Åne-tuned it on the dataset.
Table 1 shows the experimental results on automatic metrics. Following Zhang et al. (2018b), we reported the ofÔ¨Åcial automatic metrics to evaluate the methods: Hits@1, Perplexity (ppl) and F1. Given 20 response candidates, Hits@1 is the probability that the real response ranks the highest according to the model. Perplexity measures the negative log likelihood of the correct sequence output by the model, lower values indicating better performance. F1 is the harmonic mean of word-level precision and recall. As observed, our approach outperforms almost all baselines and achieves new state-of-the-art performance on ppl and F1, with highly competitive performance on Hits@1. In the revised mode, our approach still achieves the best performance, obtaining a relative improvement of 13.4% on F1 against the strongest baseline. It is worth noting that we also tried to employ F1 as the reward, but the result is far from satisfactory.
As mentioned in Dinan et al. (2019), no automatic metric is perfect for evaluating such an opendomain task. Hence, we also performed crowdsourced human evaluations on the state-of-the-art baselines (i.e. Transfertransfo & Lost In Conversation) and our proposed P2 BOT. Concretely, on the original dev set, we randomly sampled 200 responses generated by these methods and asked each worker to rate them. The rating ranges from 1
3http://github.com/huggingface/transfer-learning-conv-ai 4http://github.com/atselousov/transformer chatbot

Variant
P2 BOT-S
- Persona - Next + RS.1 ‚Üí + RS.2
‚Üí + RS.3

Hits@1(%) ‚Üë
68.7
65.5 17.6 68.4 68.6 68.6

F1(%) ‚Üë
18.14
17.77 (- 2.0%) 18.11 (- 0.1%) 18.32 (+0.9%) 18.41 (+1.5%) 19.08 (+5.2%)

BLEU(%) ‚Üë
0.56
0.57 (+ 1.8%) 0.55 (- 1.8%) 0.60 (+ 7.1%) 0.61 (+ 8.9%) 0.75 (+33.9%)

Table 3: Variant analysis results on PERSONA-CHAT revised mode, along with relative improvements (shown inside brackets) compared with P2 BOT-S. BLEU refers to the cumulative 4-gram BLEU score. ‚ÄúPersona‚Äù means dialogue generation without personas; ‚Äú- Next‚Äù ablates the auxiliary task mentioned in Section 3.1; ‚Äú+ RS.1‚Äù means only using Language Style score as the reward in the self-play Ô¨Åne-tuning phase; ‚Äú ‚Üí + RS.2‚Äù means adding Discourse Coherence to the reward on the basis of RS.1; ‚Äú ‚Üí + RS.3‚Äù is equivalent to our proposed P2 BOT.

to 4. 1 means the response is good only in terms of grammar and sentence structure; 2 means in addition to valid grammar, the response is also coherent with the context; 3 means the coherent response is meanwhile interesting and informative, instead of just a simple response like Yes; And 4 means the response is consistent with the persona of the interlocutor, which is of extreme importance for the task of reÔ¨Çecting whether the model can effectively utilize the persona information. As shown in Table 2, the results are consistent with the automatic evaluation results, demonstrating the superiority of P2 BOT against the baselines. We also conducted Wilcoxon signed-rank tests between our method and the baselines and the results show the improvements are signiÔ¨Åcant with p < 0.05.
5.3 Model Analysis
Variant Analysis We conducted variant analysis on P2 BOT to investigate the inÔ¨Çuence of RS.1, RS.2 and RS.3. Another metric BLEU (Papineni et al., 2002), which evaluates the quality of response, was introduced to make the analysis more comprehensive. We show the variant analysis results in Table 3, where P2 BOT-S is the variant of P2 BOT which is trained only in the supervised setting. As expected, the results on Hits@1 validate the important role of the auxiliary task. Across all the variants, the gains in BLEU and F1 are very small, revealing the difÔ¨Åculty in improving them. Nevertheless, solely by adding RS.3, we obtained a 25% relative improvement on BLEU, indicating the effectiveness of our proposed mutual persona

PERSONA
CONTEXT * HUMAN * * TRANSFERTRANSFO * LOST IN CONVERSATION

i. I love new kids on the block. ii. I was born in the early 80‚Äôs. iii. I also like old school hip hop. iv. My favorite toy as a child as my
lite brite.
Do you like clowns? They horrify me!
No! My favorite toy as a kid was lite brite because I was so scared!
I do not like them at all. I am a little old for them .
I do not have time for clowns. Do you like to listen to music ?
I love clowns. they are my favorite.

i. I am a blonde girl with really short hair. ii. I love wearing skinny jeans and leggings. iii. I 'm rather skinny as I like to stay in shape. iv. My favorite hobbies are listening to music
and playing video games.
What video game? I relax by knitting. Love it!

i. I‚Äôve an allergy to water. ii. I‚Äôm a famous twitch streamer. iii. I helped design the game StarCraft. iv. I am working on building a robot to be
my body double.
Cool. I did hardcore exercise four hours everyday.

I was playing Fallout. What do you look like? I‚Äô m blonde thin.

That‚Äôs a lot of exercising. I hate exercising. I just work on my robot most days .

I play RPGs. I like to wear skinny jeans and tees .
My fav color is blue, I have a lot of friends in my group.
I love HALO 3, what do you knit?

I do not exercise at all. I‚Äôm busy with my robot project .
I work at a computer company. I could make you an Android!
That sounds like a lot of fun !

Table 4: Sampled responses(*) by Human, P2 BOT and the state-of-the-art baselines.

Model
Random IR Receiver

Original

Hits@1 ‚Üë MRR ‚Üë

3.1

0.2

67.5 20.9

93.8 37.5

Revised

Hits@1 ‚Üë MRR ‚Üë

3.1

0.2

9.7

2.2

78.2 16.6

Table 5: Experimental results on Persona Perception.

perception. Similar conclusions can be drawn from the trend of F1.
Case Study For a more comprehensive comparison, we show in Table 4 some randomly sampled responses of different methods. The results suggest the responses generated by our approach are more human-like. As observed, beneÔ¨Åting from our proposed mutual persona perception, the responses of P2 BOT are more consistent, engaging and informative. For instance, in the last example in Table 4, the response ‚ÄúI‚Äôm busy with my robot project‚Äù explicates why the speaker does not exercise, meanwhile revealing that he is working on the robot, as depicted in his persona.
Error Analysis Though our approach works well in most cases, we observed that the self-play simulation might fall into repeated cycles after rounds of training, as the challenge mentioned by Li et al. (2016b). Another issue is that the bots sometimes ask redundant questions in our approach, which might be due to inappropriate hyperparameters in reward shaping.
5.4 Persona Perception Probing
Receiver plays an important role in our approach, and we are interested in its capability on perceiving persona. Therefore, we conducted experi-

Dialogue ‚Ä¶ I enjoy death metal I volunteer at the local pool ‚Ä¶ in India , that is where I'm from I'm learning about computers It is very basic but helpful
I find myself to be ‚Ä¶

Revised Persona I‚Äôm a student I listen to punk I love being in water I‚Äôm not from the U.S.

Figure 6: Visualization of the relevance scores between a sampled dialogue and its corresponding revised persona. Deeper color means higher score. We omit some context due to space limitation.

ments on a synthesized dataset. We constructed the dataset by sampling 31 persona distractors for each dialogue in PERSONA-CHAT. Two widely used ranking metrics were used to evaluate the performance: Hits@1 and Mean Reciprocal Rank (MRR). Hits@1 is the same metric as the one mentioned in Section 5.2, except that the candidate size is 32. Given a dialogue and the complete set of proÔ¨Åle sentences, MRR is the average reciprocal ranks of the dialogue-relevant proÔ¨Åle sentences. Two simple baselines Random and IR (Sordoni et al., 2015) were chosen for comparison. Table 5 shows the experimental results of different methods on the synthesized dataset. As observed, our approach achieved excellent results on both original and revised modes. For example, compared with the IR baseline, our approach achieved an absolute improvement of 26.3% on Hits@1 in the original mode. In addition, the surprising results in the revised mode further demonstrate Receiver‚Äôs capability to perceive rephrased persona.
To further understand the trained Receiver, we visualize the relevance scores between a sampled

dialogue and its corresponding revised persona in Figure 6. As illustrated, the relevance scores between related proÔ¨Åle sentences and dialogue utterances are signiÔ¨Åcantly higher. For example, the utterance ‚ÄúI volunteer at the local pool‚Äù from the interlocutor implies the proÔ¨Åle ‚ÄúI love being in the water‚Äù, and our Receiver successfully captures the relevance between them.
6 Related Work
Methods to build open-domain dialogue systems generally fall into two major categories: retrievalbased and generative-based. Retrieval-based methods retrieve response candidates and rank them based on the matching scores with the dialogue (Sordoni et al., 2015; Wu et al., 2017; Gu et al., 2019). Generative-based methods typically use SEQ2SEQ model as the backbone (Sutskever et al., 2014; Bahdanau et al., 2015; Serban et al., 2017; Wolf et al., 2019b), where the encoder extracts the information in an utterance and the decoder generates the response. Our work adopts a similar architecture. Besides supervised learning, researchers also explore reinforcement learning based methods. Lewis et al. (2017) applied reinforcement learning for negotiation dialogues and showed it outperforms supervised learning when negotiating with humans. Yang et al. (2018) proposed to generate dialogue responses by dual learning based domain adaptation. Zhang et al. (2018a) built a coherence model to provide the reward signal for penalizing dull responses. Liu et al. (2019) employed reinfrocement learning to learn an intermediate structure span. Our approach differs from this line of work in that we focus on improving personalized dialogues via mutual persona perception, which has not yet been explored before.
More recently, under the topic of dialogue personalizing, Zemlyanskiy and Sha (2018) proposed a post-processing method to re-rank candidates generated by beam search, while Olabiyi et al. (2019) employed adversarial approaches to solve the consistency problem on interlocutors‚Äô names. Madotto et al. (2019) applied meta-learning to quickly adapt to new speakers, and Tigunova et al. (2019) extracted user attributes from daily dialogues. Compared with them, our work enhances persona based dialogue generation from a novel perspective.
Furthermore, researchers explored to generate diverse responses conditioned on persona (Song et al., 2019, 2020). Personalization in goal-oriented di-

alogue systems has also received some attention (Joshi et al., 2017; Luo et al., 2019). The researches focus more on making the goal-oriented bots adjust the response according to different user proÔ¨Åles, while we aim to endow bots with persistent personalities.
7 Conclusion & Future Work
We propose P2 BOT, a transmitter-receiver framework which explicitly models understanding between interlocutors. Under this framework, mutual persona perception is incorporated as a reward signal to achieve the personalized dialogue generation. Experiments on a large public dataset PERSONA-CHAT demonstrate the effectiveness of our approach. For future work, we would like to extend Receiver to conversational recommender systems. After turns of chatting, the agent should be able to infer the user‚Äôs persona, based on which personalized contents can be recommended.
Acknowledgments
We thank all the anonymous reviewers for their valuable comments. This work was supported in part by National Natural Science Foundation of China (U1736217 and 61932003), and National Key R&D Program of China (2019YFF0302902).
References
Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua Bengio. 2015. Neural machine translation by jointly learning to align and translate. In Proceedings of the 3rd International Conference on Learning Representations, ICLR 2015, May 7-9, 2015, San Diego, CA, USA.
Jacob Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova. 2019. BERT: Pre-training of deep bidirectional transformers for language understanding. In Proceedings of the 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, NAACL 2019, Minneapolis, Minnesota. Association for Computational Linguistics.
Emily Dinan, Varvara Logacheva, Valentin Malykh, Alexander H. Miller, Kurt Shuster, Jack Urbanek, Douwe Kiela, Arthur Szlam, Iulian Serban, Ryan Lowe, Shrimai Prabhumoye, Alan W. Black, Alexander I. Rudnicky, Jason Williams, Joelle Pineau, Mikhail Burtsev, and Jason Weston. 2019. The second conversational intelligence challenge (convai2). CoRR, abs/1902.00098.
Jia-Chen Gu, Zhen-Hua Ling, Xiaodan Zhu, and Quan Liu. 2019. Dually interactive matching network for

personalized response selection in retrieval-based chatbots. In Proceedings of the 2019 Conference on Empirical Methods in Natural Language Processing and the 9th International Joint Conference on Natural Language Processing, EMNLP-IJCNLP 2019, Hong Kong, China. Association for Computational Linguistics.
Uri Hasson, Asif A Ghazanfar, Bruno Galantucci, Simon Garrod, and Christian Keysers. 2012. Brain-tobrain coupling: a mechanism for creating and sharing a social world. Trends in cognitive sciences.
Geoffrey E. Hinton, Oriol Vinyals, and Jeffrey Dean. 2015. Distilling the knowledge in a neural network. CoRR, abs/1503.02531.
Chaitanya K. Joshi, Fei Mi, and Boi Faltings. 2017. Personalization in goal-oriented dialog. CoRR, abs/1706.07503.
Diederik P. Kingma and Jimmy Ba. 2015. Adam: A method for stochastic optimization. In Proceedings of the 3rd International Conference on Learning Representations, ICLR 2015, May 7-9, 2015, San Diego, CA, USA.
Mike Lewis, Denis Yarats, Yann Dauphin, Devi Parikh, and Dhruv Batra. 2017. Deal or no deal? endto-end learning of negotiation dialogues. In Proceedings of the 2017 Conference on Empirical Methods in Natural Language Processing, EMNLP 2017, Copenhagen, Denmark. Association for Computational Linguistics.
Jiwei Li, Michel Galley, Chris Brockett, Georgios Spithourakis, Jianfeng Gao, and Bill Dolan. 2016a. A persona-based neural conversation model. In Proceedings of the 54th Annual Meeting of the Association for Computational Linguistics, ACL 2016, Berlin, Germany. Association for Computational Linguistics.
Jiwei Li, Will Monroe, Alan Ritter, Dan Jurafsky, Michel Galley, and Jianfeng Gao. 2016b. Deep reinforcement learning for dialogue generation. In Proceedings of the 2016 Conference on Empirical Methods in Natural Language Processing, EMNLP 2016, Austin, Texas. Association for Computational Linguistics.
Qian Liu, Bei Chen, Haoyan Liu, Jian-Guang Lou, Lei Fang, Bin Zhou, and Dongmei Zhang. 2019. A splitand-recombine approach for follow-up query analysis. In Proceedings of the 2019 Conference on Empirical Methods in Natural Language Processing and the 9th International Joint Conference on Natural Language Processing, EMNLP-IJCNLP 2019, Hong Kong, China. Association for Computational Linguistics.
Liangchen Luo, Wenhao Huang, Qi Zeng, Zaiqing Nie, and Xu Sun. 2019. Learning personalized end-toend goal-oriented dialog. In Proceedings of the 33rd AAAI Conference on ArtiÔ¨Åcial Intelligence, AAAI

2019, The 31st Innovative Applications of ArtiÔ¨Åcial Intelligence Conference, IAAI 2019, The 9th AAAI Symposium on Educational Advances in ArtiÔ¨Åcial Intelligence, EAAI 2019, January 27 - February 1, 2019, Honolulu, Hawaii, USA. AAAI Press.
Andrea Madotto, Zhaojiang Lin, Chien-Sheng Wu, and Pascale Fung. 2019. Personalizing dialogue agents via meta-learning. In Proceedings of the 57th Annual Meeting of the Association for Computational Linguistics, ACL 2019, Florence, Italy. Association for Computational Linguistics.
Pierre-Emmanuel Mazare¬¥, Samuel Humeau, Martin Raison, and Antoine Bordes. 2018. Training millions of personalized dialogue agents. In Proceedings of the 2018 Conference on Empirical Methods in Natural Language Processing, EMNLP 2018, Brussels, Belgium. Association for Computational Linguistics.
Alexander Miller, Will Feng, Dhruv Batra, Antoine Bordes, Adam Fisch, Jiasen Lu, Devi Parikh, and Jason Weston. 2017. ParlAI: A dialog research software platform. In Proceedings of the 2017 Conference on Empirical Methods in Natural Language Processing: System Demonstrations, EMNLP 2017, Copenhagen, Denmark. Association for Computational Linguistics.
Oluwatobi Olabiyi, Anish Khazane, Alan Salimov, and Erik T. Mueller. 2019. An adversarial learning framework for a persona-based multi-turn dialogue model. CoRR, abs/1905.01992.
Kishore Papineni, Salim Roukos, Todd Ward, and WeiJing Zhu. 2002. BLEU: a method for automatic evaluation of machine translation. In Proceedings of the 40th Annual Meeting of the Association for Computational Linguistics, ACL 2002, Philadelphia, Pennsylvania, USA. Association for Computational Linguistics.
Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, Alban Desmaison, Andreas Kopf, Edward Yang, Zachary DeVito, Martin Raison, Alykhan Tejani, Sasank Chilamkurthy, Benoit Steiner, Lu Fang, Junjie Bai, and Soumith Chintala. 2019. Pytorch: An imperative style, high-performance deep learning library. In H. Wallach, H. Larochelle, A. Beygelzimer, F. d'Alche¬¥-Buc, E. Fox, and R. Garnett, editors, Advances in Neural Information Processing Systems 32: Annual Conference on Neural Information Processing Systems 2019, NeurIPS 2019, December 8-14, 2019, Vancouver, BC, Canada. Curran Associates, Inc.
Alec Radford, Karthik Narasimhan, Tim Salimans, and Ilya Sutskever. 2018. Improving language understanding by generative pre-training.
Iulian Vlad Serban, Alessandro Sordoni, Ryan Lowe, Laurent Charlin, Joelle Pineau, Aaron C. Courville,

and Yoshua Bengio. 2017. A hierarchical latent variable encoder-decoder model for generating dialogues. In Proceedings of the 31st AAAI Conference on ArtiÔ¨Åcial Intelligence, AAAI 2019, February 4-9, 2017, San Francisco, California, USA. AAAI Press.
Haoyu Song, Wei-Nan Zhang, Jingwen Hu, and Ting Liu. 2020. Generating persona consistent dialogues by exploiting natural language inference. In Proceedings of the 34th AAAI Conference on ArtiÔ¨Åcial Intelligence, AAAI 2020, February 7-12, 2020, New York City, New York, USA. AAAI Press.
Haoyu Song, Weinan Zhang, Yiming Cui, Dong Wang, and Ting Liu. 2019. Exploiting persona information for diverse generation of conversational responses. In Proceedings of the 28th International Joint Conference on ArtiÔ¨Åcial Intelligence, IJCAI 2019, August 10-16, 2019, Macao, China.
Alessandro Sordoni, Michel Galley, Michael Auli, Chris Brockett, Yangfeng Ji, Margaret Mitchell, Jian-Yun Nie, Jianfeng Gao, and Bill Dolan. 2015. A neural network approach to context-sensitive generation of conversational responses. In Proceedings of the 2015 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, NAACL 2015, Denver, Colorado. Association for Computational Linguistics.
Ilya Sutskever, Oriol Vinyals, and Quoc V. Le. 2014. Sequence to sequence learning with neural networks. In Advances in Neural Information Processing Systems 27: Annual Conference on Neural Information Processing Systems 2014, NIPS 2014, December 813 2014, Montreal, Quebec, Canada.
Richard S. Sutton, David A. McAllester, Satinder P. Singh, and Yishay Mansour. 1999. Policy gradient methods for reinforcement learning with function approximation. In Advances in Neural Information Processing Systems 12: Annual Conference on Neural Information Processing Systems 1999, NIPS 1999, November 29 - December 4, 1999, Denver, Colorado, USA,. The MIT Press.
Anna Tigunova, Andrew Yates, Paramita Mirza, and Gerhard Weikum. 2019. Listening between the lines: Learning personal attributes from conversations. In Proceedings of the World Wide Web Conference, WWW 2019, May 13-17, 2019, San Francisco, CA, USA. ACM.
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez, Lukasz Kaiser, and Illia Polosukhin. 2017. Attention is all you need. In Advances in Neural Information Processing Systems 30: Annual Conference on Neural Information Processing Systems 2017, NIPS 2017, December 4-9, 2017, Long Beach, CA, USA.
Lex Weaver and Nigel Tao. 2001. The optimal reward baseline for gradient-based reinforcement learning.

In Proceedings of the 17th Conference in Uncertainty in ArtiÔ¨Åcial Intelligence, UAI 2001, August 25, 2001, University of Washington, Seattle, Washington, USA. Morgan Kaufmann.
Ronald J. Williams. 1992. Simple statistical gradientfollowing algorithms for connectionist reinforcement learning. Machine learning.
Thomas Wolf, Lysandre Debut, Victor Sanh, Julien Chaumond, Clement Delangue, Anthony Moi, Pierric Cistac, Tim Rault, Re¬¥mi Louf, Morgan Funtowicz, and Jamie Brew. 2019a. Huggingface‚Äôs transformers: State-of-the-art natural language processing. CoRR, abs/1910.03771.
Thomas Wolf, Victor Sanh, Julien Chaumond, and Clement Delangue. 2019b. TransferTransfo: A transfer learning approach for neural network based conversational agents. CoRR, abs/1901.08149.
Yu Wu, Wei Wu, Chen Xing, Ming Zhou, and Zhoujun Li. 2017. Sequential matching network: A new architecture for multi-turn response selection in retrieval-based chatbots. In Proceedings of the 55th Annual Meeting of the Association for Computational Linguistics, ACL 2017, Vancouver, Canada. Association for Computational Linguistics.
Min Yang, Wenting Tu, Qiang Qu, Zhou Zhao, Xiaojun Chen, and Jia Zhu. 2018. Personalized response generation by dual-learning based domain adaptation. Neural Networks.
Yury Zemlyanskiy and Fei Sha. 2018. Aiming to know you better perhaps makes me a more engaging dialogue partner. In Proceedings of the 22nd Conference on Computational Natural Language Learning, CoNLL 2018, Brussels, Belgium. Association for Computational Linguistics.
Hainan Zhang, Yanyan Lan, Jiafeng Guo, Jun Xu, and Xueqi Cheng. 2018a. Reinforcing coherence for sequence to sequence model in dialogue generation. In Proceedings of the 27th International Joint Conference on ArtiÔ¨Åcial Intelligence, IJCAI 2018, July 1319, 2018, Stockholm, Sweden.
Saizheng Zhang, Emily Dinan, Jack Urbanek, Arthur Szlam, Douwe Kiela, and Jason Weston. 2018b. Personalizing dialogue agents: I have a dog, do you have pets too? In Proceedings of the 56th Annual Meeting of the Association for Computational Linguistics, ACL 2018, Melbourne, Australia. Association for Computational Linguistics.

